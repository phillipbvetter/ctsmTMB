<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="sdeTMB">
<title>estimate: Estimating model parameters and states • sdeTMB</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Mukta-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="estimate: Estimating model parameters and states">
<meta property="og:description" content="sdeTMB">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sdeTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/sdeTMB.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/construct_nll.html">construct_nll: How to extract function handlers, and choosing your own optimizer</a>
    <a class="dropdown-item" href="../articles/estimate.html">estimate: Estimating model parameters and states</a>
    <a class="dropdown-item" href="../articles/observation_equations.html">observations: Using functions on the left-hand side</a>
    <a class="dropdown-item" href="../articles/predict.html">predict: Forecasting the model states and observations.</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phillipbvetter/sdeTMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>estimate: Estimating model parameters and states</h1>
                        <h4 data-toc-skip class="author"></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phillipbvetter/sdeTMB/blob/HEAD/vignettes/estimate.Rmd" class="external-link"><code>vignettes/estimate.Rmd</code></a></small>
      <div class="d-none name"><code>estimate.Rmd</code></div>
    </div>

    
    
<p>In this document we demonstrate the functionality of
<code>estimate</code> further. We use the Ornstein-Uhlenbeck process for
this purpose.</p>
<p><span class="math display">\[
\mathrm{d}X_{t} = \theta (\mu - X_{t}) \, \mathrm{d}t \, + \sigma_{X} \,
\mathrm{d}B_{t}
\]</span></p>
<p><span class="math display">\[
Y_{t_{k}} = X_{t_{k}} + e_{t_{k}}, \qquad e_{t_{k}} \sim
\mathcal{N}\left(0,\sigma_{Y}^{2}\right)  
\]</span></p>
<div class="section level2">
<h2 id="construct-model-object">Construct model object<a class="anchor" aria-label="anchor" href="#construct-model-object"></a>
</h2>
<hr>
<p>We now construct the <code>sdeTMB</code> model object as per
usual</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create model object</span></span>
<span><span class="va">obj</span> <span class="op">=</span> <span class="va"><a href="../reference/sdeTMB.html">sdeTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set name of model (and the created .cpp file)</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">set_modelname</span><span class="op">(</span><span class="st">"ornstein_uhlenbeck"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add system equations</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">add_systems</span><span class="op">(</span></span>
<span>  <span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma_x</span><span class="op">*</span><span class="va">dw</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add observation equations</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">add_observations</span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">x</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set observation equation variances</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">add_observation_variances</span><span class="op">(</span></span>
<span>  <span class="va">y</span> <span class="op">~</span> <span class="va">sigma_y</span><span class="op">^</span><span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify algebraic relations</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">add_algebraics</span><span class="op">(</span></span>
<span>  <span class="va">theta</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logtheta</span><span class="op">)</span>,</span>
<span>  <span class="va">sigma_x</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logsigma_x</span><span class="op">)</span>,</span>
<span>  <span class="va">sigma_y</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logsigma_y</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Specify parameter initial values and lower/upper bounds in estimation</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">add_parameters</span><span class="op">(</span></span>
<span>  logtheta   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">5</span>,    lower <span class="op">=</span> <span class="fl">0</span>,    upper <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  mu         <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>    initial <span class="op">=</span> <span class="fl">0</span>,    lower <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>,  upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  logsigma_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1e-1</span>, lower <span class="op">=</span> <span class="fl">1e-5</span>, upper <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  logsigma_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1e-1</span>, lower <span class="op">=</span> <span class="fl">1e-5</span>, upper <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set initial state mean and covariance</span></span>
<span><span class="va">obj</span><span class="op">$</span><span class="fu">set_initial_state</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1e-1</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="using-estimate---default-settings">Using <code>estimate</code> - default settings<a class="anchor" aria-label="anchor" href="#using-estimate---default-settings"></a>
</h2>
<hr>
<p>We can run <code>estimate</code> directly with the default
settings</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span><span class="va">.data</span><span class="op">)</span></span></code></pre></div>
<p>This is the same as using the default settings</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">obj</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span>data <span class="op">=</span> <span class="va">.data</span>, </span>
<span>             method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>             ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>             ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>             loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>             loss_c <span class="op">=</span> <span class="fl">3</span>,</span>
<span>             unscented_hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">1</span>, beta<span class="op">=</span><span class="fl">0</span>, kappa<span class="op">=</span><span class="fl">3</span><span class="op">-</span><span class="va">private</span><span class="op">$</span><span class="va">number.of.states</span><span class="op">)</span>,</span>
<span>             control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace<span class="op">=</span><span class="fl">1</span>,iter.max<span class="op">=</span><span class="fl">1e5</span>,eval.max<span class="op">=</span><span class="fl">1e5</span><span class="op">)</span>,</span>
<span>             use.hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             laplace.residuals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             unconstrained.optim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>             silent <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Let’s walk through the various arguments and their effect:</p>
</div>
<div class="section level2">
<h2 id="argument-method">Argument: <code>method</code><a class="anchor" aria-label="anchor" href="#argument-method"></a>
</h2>
<hr>
<p>The <code>method</code> argument determines which underlying
estimation techniques is used. The current implementation supports the
following</p>
<ol style="list-style-type: decimal">
<li>
<code>method='ekf'</code>: The Extended Kalman Filter.</li>
<li>
<code>method='ukf'</code>: The Unscented Kalman Filter - currently
disabled.</li>
<li>
<code>method='laplace'</code>: The Laplace Approximation</li>
</ol>
<p>The former two are quite similar in that they are based on the Kalman
Filter theory. The assumptions of normality in the state transition and
observation equation are fundamental, although the implemented filters
are standard non-linear filters, in the sense that they try to overcome
these assumptions for small non-linearities. The Unscented Kalman Filter
is generally considered to perform better in these cases.</p>
<!-- The Extended Kalman Filter linearizes (to first order in the drift, and zeroth order in the diffusion) around the expectation of the state value to obtain prior and posterior state estimates as a way to handle non-linearities in system and observation equations.  -->
<p>The latter <code>laplace</code> method employs the Laplace
Approximation method of to integration out random effects. In this
formulation we consider the states as random effects, and parameters as
fixed. The underlying assumption is one of normality, but its
implementation allows for the flexibility of choosing arbitrary
distributions (not yet implemented.)</p>
<p>Both of these methods can be used to estimate parameter and states.
In the case of <code>laplace</code> the states will be smoothed
(conditioned on both past and future observations).</p>
</div>
<div class="section level2">
<h2 id="argument-ode-solver">Argument: <code>ode.solver</code><a class="anchor" aria-label="anchor" href="#argument-ode-solver"></a>
</h2>
<hr>
<p>This argument is only used by the Kalman Filter methods
i.e. <code>ekf</code> and <code>ukf</code>. The argument determines the
algorithm used to integrate forward the moment (mean and variance)
differential equations. The current implementation supports</p>
<ol style="list-style-type: decimal">
<li>
<code>ode.solver='euler'</code>: The forward Euler scheme</li>
<li>
<code>ode.solver='rk4'</code>: The 4th order Runge-Kutta scheme</li>
</ol>
</div>
<div class="section level2">
<h2 id="argument-ode-timestep">Argument: <code>ode.timestep</code><a class="anchor" aria-label="anchor" href="#argument-ode-timestep"></a>
</h2>
<hr>
<p>This argument determines the time-step used in the ODE solvers</p>
</div>
<div class="section level2">
<h2 id="argument-loss-and-loss_c">Argument: <code>loss</code> and <code>loss_c</code><a class="anchor" aria-label="anchor" href="#argument-loss-and-loss_c"></a>
</h2>
<hr>
</div>
<div class="section level2">
<h2 id="argument-use_hessian">Argument: <code>use_hessian</code><a class="anchor" aria-label="anchor" href="#argument-use_hessian"></a>
</h2>
<hr>
</div>
<div class="section level2">
<h2 id="argument-compile">Argument: <code>compile</code><a class="anchor" aria-label="anchor" href="#argument-compile"></a>
</h2>
<hr>
</div>
<div class="section level2">
<h2 id="argument-control">Argument: <code>control</code><a class="anchor" aria-label="anchor" href="#argument-control"></a>
</h2>
<hr>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
