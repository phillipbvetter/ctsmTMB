<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting Started • ctsmTMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.10/font.css" rel="stylesheet">
<link href="../deps/Google_Sans_Code-0.4.10/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctsmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/ctsmTMB.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes">
<li><a class="dropdown-item" href="../articles/estimate.html">Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/predict.html">Prediction</a></li>
    <li><a class="dropdown-item" href="../articles/simulate.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/using_another_optimizer.html">Likelihood (Extracting Function Handlers)</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-math-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Math Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-math-details">
<li><a class="dropdown-item" href="../articles/linear_kalman_filter.html">Linear Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/extended_kalman_filter.html">Extended Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/unscented_kalman_filter.html">Unscented Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/laplace_approx.html">Laplace Smoother</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/phillipbvetter/ctsmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Getting Started</h1>
                        <h4 data-toc-skip class="author"></h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/phillipbvetter/ctsmTMB/blob/HEAD/vignettes/ctsmTMB.Rmd"><code>vignettes/ctsmTMB.Rmd</code></a></small>
      <div class="d-none name"><code>ctsmTMB.Rmd</code></div>
    </div>

    
    
<p>Welcome to this guide on how to work with <code>ctsmTMB</code> for
modelling time-series data.</p>
<p>In this example we consider a simple 1D mean-reverting stochastic
differential equation model, the Ornstein-Uhlenbeck process:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">d</mi><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><mi>θ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>μ</mi><mo>−</mo><msub><mi>x</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mspace width="0.167em"></mspace><mi mathvariant="normal">d</mi><mi>t</mi><mspace width="0.167em"></mspace><mo>+</mo><msub><mi>σ</mi><mi>x</mi></msub><mspace width="0.167em"></mspace><mi mathvariant="normal">d</mi><msub><mi>b</mi><mi>t</mi></msub></mrow><annotation encoding="application/x-tex"> 
\mathrm{d}x_{t} = \theta (\mu - x_{t}) \, \mathrm{d}t \, + \sigma_{x} \, \mathrm{d}b_{t} 
</annotation></semantics></math> Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>μ</mi><annotation encoding="application/x-tex">\mu</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>x</mi></msub><annotation encoding="application/x-tex">\sigma_x</annotation></semantics></math>
are (fixed effects) parameters to be estimated.</p>
<p>We assume that we have <strong>direct</strong> observations of the
state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>t</mi></msub><annotation encoding="application/x-tex">x_{t}</annotation></semantics></math>,
at discrete times
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>k</mi></msub><annotation encoding="application/x-tex">t_k</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>=</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>,</mo><mi>.</mi><mi>.</mi><mi>.</mi><mo>,</mo><mi>N</mi></mrow><annotation encoding="application/x-tex">k=0,1,2,...,N</annotation></semantics></math>
i.e. the observation equation is
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><msub><mi>t</mi><mi>k</mi></msub></msub><mo>=</mo><msub><mi>x</mi><msub><mi>t</mi><mi>k</mi></msub></msub><mo>+</mo><msub><mi>ε</mi><msub><mi>t</mi><mi>k</mi></msub></msub></mrow><annotation encoding="application/x-tex">
y_{t_{k}} = x_{t_{k}} + \varepsilon_{t_{k}}
</annotation></semantics></math></p>
<p>The residuals are assumed to be Gaussian, and we choose the variance
as
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ε</mi><msub><mi>t</mi><mi>k</mi></msub></msub><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><msubsup><mi>σ</mi><mi>y</mi><mn>2</mn></msubsup><mo>⋅</mo><msub><mi>u</mi><msub><mi>t</mi><mi>k</mi></msub></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\varepsilon_{t_{k}} \sim N(0,\sigma_{y}^{2} \cdot u_{t_{k}})
</annotation></semantics></math></p>
<p>Here
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\sigma_{y}</annotation></semantics></math>
is a fixed effect parameter (also to be estimated), and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>u</mi><mi>t</mi></msub><annotation encoding="application/x-tex">u_{t}</annotation></semantics></math>
is a known time-dependent input. The input is added here for sake of
introduction, just to demonstrate how time-dependent inputs are
specified. We could for example imagine the input to be given by
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><msub><mi>t</mi><mi>k</mi></msub></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mn>1</mn><mo>,</mo><mn>4</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>4</mn><mo>,</mo><mn>1</mn><mo>,</mo><mn>4</mn><mi>⋯</mi><mo stretchy="true" form="postfix">}</mo></mrow></mrow><annotation encoding="application/x-tex">
u_{t_{k}} = \left\{ 1, 4, 1, 4, 1, 4 \cdots \right\}
</annotation></semantics></math> such that certain observations have
twice the standard deviation of others, and thus carry less weight
(information) about the latent state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>x</mi><annotation encoding="application/x-tex">x</annotation></semantics></math>.
In the remainder of this vignette however, we simply set
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>u</mi><mi>t</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">u_{t} = 1</annotation></semantics></math>.</p>
<div class="section level2">
<h2 id="initialising">Initialising<a class="anchor" aria-label="anchor" href="#initialising"></a>
</h2>
<p>We initialise a <code>ctsmTMB</code> model object using</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/phillipbvetter/ctsmTMB">ctsmTMB</a></span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/ctsmTMB.html">ctsmTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Printing the model object in the console reveals some basic
information about it:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This ctsmTMB model contains:              </span></span>
<span><span class="co">## States       0</span></span>
<span><span class="co">## Diffusions   0</span></span>
<span><span class="co">## Observations 0</span></span>
<span><span class="co">## Inputs       1</span></span>
<span><span class="co">## Parameters   0</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="add-system-equations">Add system equations<a class="anchor" aria-label="anchor" href="#add-system-equations"></a>
</h2>
<hr>
<p>First we specify the stochastic differential equation governing our
latent state
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>t</mi></msub><annotation encoding="application/x-tex">x_t</annotation></semantics></math>.
This is straight-forward using <strong>R</strong> formulas, choosing
appropriate character names for the parameters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">addSystem</span><span class="op">(</span><span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma_x</span> <span class="op">*</span> <span class="va">dw</span><span class="op">)</span></span></code></pre></div>
<p>We emphasize that drift terms must be multiplied by a <code>dt</code>
and diffusion terms by a <code>dw</code> or <code>dw#</code> where # is
some number e.g. <code>dw2</code>. A single state equation may contain
any number of diffusion terms i.e.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">addSystem</span><span class="op">(</span><span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span> <span class="op">-</span> <span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma_x1</span> <span class="op">*</span> <span class="va">dw1</span> <span class="op">+</span> <span class="va">x</span> <span class="op">*</span> <span class="va">sigma_x2</span> <span class="op">*</span> <span class="va">dw2</span> <span class="op">+</span> <span class="va">dw3</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-observation-equations">Add observation equations<a class="anchor" aria-label="anchor" href="#add-observation-equations"></a>
</h2>
<hr>
<p>Now the observation equations of the system must be specified. This
amounts to specifying the mean and variance of the residual normal
distribution. First the mean is specified i.e.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">addObs</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></code></pre></div>
<p>The variable used on the left-hand side, here <code>y</code>,
determines the name of the relevant observations to-be provided in the
data for maximum likelihood estimation later.</p>
</div>
<div class="section level2">
<h2 id="add-observation-variances">Add observation variances<a class="anchor" aria-label="anchor" href="#add-observation-variances"></a>
</h2>
<hr>
<p>Next we specify the residual variance, using the name given to the
observation equation above, in <code>addObs</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">setVariance</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sigma_y</span><span class="op">^</span><span class="fl">2</span> <span class="op">*</span> <span class="va">u</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="add-inputs">Add inputs<a class="anchor" aria-label="anchor" href="#add-inputs"></a>
</h2>
<hr>
<p>Next, we declare which variables are time-dependent inputs via</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">addInput</span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span></code></pre></div>
<p>These shall must also be provided in the data later, similar to
observations.</p>
</div>
<div class="section level2">
<h2 id="add-parameters">Add parameters<a class="anchor" aria-label="anchor" href="#add-parameters"></a>
</h2>
<hr>
<p>We must also specify the (fixed effects) parameters, and in addition
their initial/lower/upper values for the estimation.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span></span>
<span>  theta   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">5</span>,    lower <span class="op">=</span> <span class="fl">0</span>,    upper <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>  mu      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">0</span>,    lower <span class="op">=</span> <span class="op">-</span><span class="fl">10</span>,  upper <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  sigma_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1e-1</span>, lower <span class="op">=</span> <span class="fl">1e-5</span>, upper <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>  sigma_y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1e-1</span>, lower <span class="op">=</span> <span class="fl">1e-5</span>, upper <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A parameter can be fixed by supplying just a single value. It is for
instance typically useful to fix observation noise parameters because
simultaneous identification of observation and process noise is
difficult in practice, and some knowledge about observation noise may be
known. Thus, let us fix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>y</mi></msub><annotation encoding="application/x-tex">\sigma_{y}</annotation></semantics></math>
to a somewhat arbitrary but reasonable value:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span></span>
<span>  sigma_y  <span class="op">=</span> <span class="fl">0.05</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Let’s inspect the model object again, and see that it is no longer
empty:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## This ctsmTMB model contains:              </span></span>
<span><span class="co">## States       1</span></span>
<span><span class="co">## Diffusions   1</span></span>
<span><span class="co">## Observations 1</span></span>
<span><span class="co">## Inputs       2</span></span>
<span><span class="co">## Parameters   4</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## System Equations:</span></span>
<span><span class="co">##   dx ~ theta * (mu - x) * dt + sigma_x * dw </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Observation Equations:</span></span>
<span><span class="co">##   y:  y ~ x + e   e ~ N(0, sigma_y^2 * u) </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Inputs:</span></span>
<span><span class="co">##   u</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Parameters:</span></span>
<span><span class="co">##   theta, mu, sigma_x, sigma_y</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Fixed Parameters:</span></span>
<span><span class="co">##   sigma_y</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="set-initial-state-and-covariance">Set initial state and covariance<a class="anchor" aria-label="anchor" href="#set-initial-state-and-covariance"></a>
</h2>
<hr>
<p>Lastly the state distribution at the initial time point must be
specified via its mean and variance.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial.state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean<span class="op">=</span><span class="fl">1</span>, cov<span class="op">=</span><span class="fl">1e-1</span><span class="op">)</span></span>
<span><span class="va">model</span><span class="op">$</span><span class="fu">setInitialState</span><span class="op">(</span>initial.state<span class="op">=</span><span class="va">initial.state</span><span class="op">)</span></span></code></pre></div>
<p>Note that in higher dimensions the provided covariance
<code>cov</code> must be a matrix. A simple initial covariance could
just be a scaled identity e.g. in two dimensions
<code>cov = 1e-1 * diag(2)</code></p>
</div>
<div class="section level2">
<h2 id="generate-data">Generate Data<a class="anchor" aria-label="anchor" href="#generate-data"></a>
</h2>
<hr>
<p>The model has now been fully specified, and state and parameter
estimation can be performed on the data at hand.</p>
<p>In this particular example we generate some fake data. This can be
achieved by simulating a stochastic realization of the stochastic
differential equation, and adding some observation noise to it.</p>
<p>We achieve this task using the <code>simulate</code> method of the
model object, which perform stochastic simulations based on the <a href="https://en.wikipedia.org/wiki/Euler%E2%80%93Maruyama_method" class="external-link">Euler-Maruyama
scheme</a>. The user is referred to the <a href="https://phillipbvetter.github.io/ctsmTMB/articles/simulate.html" class="external-link">simulation
vignette</a> for further details.</p>
<p>We choose the true parameters to be
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi><mo>=</mo><mn>10.0</mn><mspace width="2.0em"></mspace><mi>μ</mi><mo>=</mo><mn>1.00</mn><mspace width="2.0em"></mspace><msub><mi>σ</mi><mi>x</mi></msub><mo>=</mo><mn>1.00</mn><mspace width="2.0em"></mspace><msub><mi>σ</mi><mi>y</mi></msub><mo>=</mo><mn>0.05</mn></mrow><annotation encoding="application/x-tex">
\theta = 10.0 \qquad \mu=1.00 \qquad \sigma_{x} = 1.00 \qquad \sigma_{y}=0.05
</annotation></semantics></math></p>
<p>The code below performs the simulation and prepares data for
likelihood estimation:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set simulation settings</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">11</span><span class="op">)</span></span>
<span><span class="va">true.pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>theta<span class="op">=</span><span class="fl">10</span>, mu<span class="op">=</span><span class="fl">1</span>, sigma_x<span class="op">=</span><span class="fl">1</span>, sigma_y<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">dt.sim</span> <span class="op">&lt;-</span> <span class="fl">1e-3</span></span>
<span><span class="va">t.end</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">t.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">t.end</span>, by<span class="op">=</span><span class="va">dt.sim</span><span class="op">)</span></span>
<span><span class="va">df.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>t<span class="op">=</span><span class="va">t.sim</span>, u<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform simulation</span></span>
<span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>data<span class="op">=</span><span class="va">df.sim</span>, </span>
<span>                      pars<span class="op">=</span><span class="va">true.pars</span>, </span>
<span>                      n.sims<span class="op">=</span><span class="fl">1</span>, </span>
<span>                      silent<span class="op">=</span><span class="cn">T</span>, </span>
<span>                      initial.state<span class="op">=</span><span class="va">initial.state</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">sim</span><span class="op">$</span><span class="va">states</span><span class="op">$</span><span class="va">x</span><span class="op">$</span><span class="va">i0</span><span class="op">$</span><span class="va">x1</span></span>
<span></span>
<span><span class="co"># Extract observations from simulation and add noise</span></span>
<span><span class="va">iobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">t.sim</span><span class="op">)</span>, by<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">t.obs</span> <span class="op">&lt;-</span> <span class="va">t.sim</span><span class="op">[</span><span class="va">iobs</span><span class="op">]</span></span>
<span><span class="va">y</span> <span class="op">=</span> <span class="va">x</span><span class="op">[</span><span class="va">iobs</span><span class="op">]</span> <span class="op">+</span> <span class="va">true.pars</span><span class="op">[</span><span class="st">"sigma_y"</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">iobs</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data-frame</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  t <span class="op">=</span> <span class="va">t.obs</span>,</span>
<span>  u <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  y <span class="op">=</span> <span class="va">y</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the simulation and observed data</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.sim</span>,y<span class="op">=</span><span class="va">x</span>,color<span class="op">=</span><span class="st">"Simulation"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">t.obs</span>,y<span class="op">=</span><span class="va">y</span>,fill<span class="op">=</span><span class="st">"Observations"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ctsmTMB</span><span class="fu">:::</span><span class="fu">getggplot2theme</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"t"</span>, y<span class="op">=</span><span class="st">"x"</span>,color<span class="op">=</span><span class="st">""</span>,fill<span class="op">=</span><span class="st">""</span><span class="op">)</span></span></code></pre></div>
<p><img src="ctsmTMB_files/figure-html/unnamed-chunk-12-1.png" alt="The plot shows a simulated trajectory and associated observations sampled from it." width="100%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="perform-estimation">Perform estimation<a class="anchor" aria-label="anchor" href="#perform-estimation"></a>
</h2>
<hr>
<p>We can now pass the <code>data</code> to the <code>estimate</code>
method. This will build the model, perform various checks, construct the
computational graph for automatic differentiation, and then perform the
optimization.</p>
<p><em><strong>Note</strong>: The data <em>must</em> contain an
increasing time column named <code>t</code> and columns for each of the
specified inputs and observations, in this case <code>u</code> and
<code>y</code>.</em></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Checking and setting data...</span></span></code></pre>
<pre><code><span><span class="co">## Constructing objective function and derivative tables...</span></span></code></pre>
<pre><code><span><span class="co">## Minimizing the negative log-likelihood...</span></span></code></pre>
<pre><code><span><span class="co">##   0:     7625.6873:  5.00000  0.00000 0.100000</span></span>
<span><span class="co">##  10:    -384.86492:  7.81233  1.12328  1.01154</span></span></code></pre>
<pre><code><span><span class="co">##   Optimization finished!:</span></span>
<span><span class="co">##             Elapsed time: 0.013 seconds.</span></span>
<span><span class="co">##             The objective value is: -3.870659e+02</span></span>
<span><span class="co">##             The maximum gradient component is: 1.2e-04</span></span>
<span><span class="co">##             The convergence message is: relative convergence (4)</span></span>
<span><span class="co">##             Iterations: 17</span></span>
<span><span class="co">##             Evaluations: Fun: 20 Grad: 18</span></span>
<span><span class="co">##             See stats::nlminb for available tolerance/control arguments.</span></span></code></pre>
<pre><code><span><span class="co">## Returning results...</span></span></code></pre>
<pre><code><span><span class="co">## Finished!</span></span></code></pre>
<p><em><strong>Note</strong>: a time-consuming step in the estimation
procedure is construction of the AD graph of the underlying likelihood
function, but the time spent for this task relative to the optimization
time will even out for models with more parameters.</em></p>
<p>The output generated during the optimization is the objective
(negative log-likelihood) value and the parameter values at the current
step. The optimizer used by <strong>ctsmTMB</strong> is the
<em>nlminb</em> optimizer from the <em>stats</em> library.</p>
<p>We refer the user to the <a href="https://phillipbvetter.github.io/ctsmTMB/articles/estimate.html" class="external-link">estimation
vignette</a> for further details on the available arguments to
<code>estimate</code>, and to the <a href="https://phillipbvetter.github.io/ctsmTMB/articles/using_another_optimizer.html" class="external-link">‘use
another optimizer’ vignette</a> for details on how to use another
optimizer than <em>nlminb</em>.</p>
</div>
<div class="section level2">
<h2 id="inspecting-the-fit-object">Inspecting the <code>fit</code> object<a class="anchor" aria-label="anchor" href="#inspecting-the-fit-object"></a>
</h2>
<hr>
<p>The <code>fit</code> object contains the following entries</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "convergence"  "nll"          "nll.gradient" "nll.hessian"  "par.fixed"   </span></span>
<span><span class="co">##  [6] "sd.fixed"     "cov.fixed"    "tvalue"       "Pr.tvalue"    "states"      </span></span>
<span><span class="co">## [11] "residuals"    "observations" "private"</span></span></code></pre>
<p>The first is a boolean which indicates whether estimation was
successful</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">convergence</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0</span></span></code></pre>
<p>which is just a copy of the optimization message from
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb</a></code>.</p>
<p>The second is the likelihood value at the found optimum</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">nll</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -387.0659</span></span></code></pre>
<p>the third is the likelihood gradient at the optimum</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">nll.gradient</span></span></code></pre></div>
<pre><code><span><span class="co">##         theta            mu       sigma_x </span></span>
<span><span class="co">## -3.161067e-06 -1.208976e-04 -4.518894e-05</span></span></code></pre>
<p>and the fourth is the likelihood hessian at the optimum</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">nll.hessian</span></span></code></pre></div>
<pre><code><span><span class="co">##              theta          mu     sigma_x</span></span>
<span><span class="co">## theta    0.2720836   0.1521370  -4.8642930</span></span>
<span><span class="co">## mu       0.1521370 469.9827505   0.7193716</span></span>
<span><span class="co">## sigma_x -4.8642930   0.7193716 553.4547321</span></span></code></pre>
<div class="section level3">
<h3 id="parameter-estimates">Parameter estimates<a class="anchor" aria-label="anchor" href="#parameter-estimates"></a>
</h3>
<hr>
<p>Printing the <code>fit</code> object reveals a standard coefficient
matrix for the parameter estimates.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Coefficent Matrix </span></span>
<span><span class="co">##         Estimate Std. Error t value  Pr(&gt;|t|)    </span></span>
<span><span class="co">## theta   9.199369   2.088424  4.4049 1.296e-05 ***</span></span>
<span><span class="co">## mu      1.064966   0.046133 23.0848 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## sigma_x 0.946988   0.046301 20.4529 &lt; 2.2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>We can see the parameter estimate and the associated standard error
together with a one-dimensional t-test statistic and associated P-value
for the common hypothesis test <span class="math display">$$
H_{0}: p = 0 \\
H_{1}: p \neq 0
$$</span></p>
<p><em><strong>Note</strong> The large uncertainty in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
here is primarily caused by a relatively short time-series (2 seconds),
relative to the characteristic time of the process
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>=</mo><mn>1</mn><mi>/</mi><mi>θ</mi><mo>=</mo><mn>0.1</mn><mspace width="0.167em"></mspace><mtext mathvariant="normal">sec</mtext></mrow><annotation encoding="application/x-tex">\tau = 1/\theta = 0.1 \, \text{sec}</annotation></semantics></math>.</em></p>
<p>The parameter-related information can be extracted from the fit
object. The estimated (fixed) parameters:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">par.fixed</span></span></code></pre></div>
<pre><code><span><span class="co">##     theta        mu   sigma_x </span></span>
<span><span class="co">## 9.1993693 1.0649661 0.9469882</span></span></code></pre>
<p>The standard deviations of the (fixed) parameters:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">sd.fixed</span></span></code></pre></div>
<pre><code><span><span class="co">##      theta         mu    sigma_x </span></span>
<span><span class="co">## 2.08842441 0.04613283 0.04630096</span></span></code></pre>
<p>The covariance of the (fixed) parameters:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">cov.fixed</span></span></code></pre></div>
<pre><code><span><span class="co">##                theta            mu       sigma_x</span></span>
<span><span class="co">## theta    4.361516497 -1.470533e-03  3.833512e-02</span></span>
<span><span class="co">## mu      -0.001470533  2.128238e-03 -1.569071e-05</span></span>
<span><span class="co">## sigma_x  0.038335117 -1.569071e-05  2.143779e-03</span></span></code></pre>
<p>The parameter covariance is found by inverting the likelihood hessian
at the found optimum i.e.:</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">nll.hessian</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                theta            mu       sigma_x</span></span>
<span><span class="co">## theta    4.361516497 -1.470533e-03  3.833512e-02</span></span>
<span><span class="co">## mu      -0.001470533  2.128238e-03 -1.569071e-05</span></span>
<span><span class="co">## sigma_x  0.038335117 -1.569071e-05  2.143779e-03</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="state-estimates">State estimates<a class="anchor" aria-label="anchor" href="#state-estimates"></a>
</h3>
<hr>
<p>The optimal state distributions associated with the estimated
parameters can be extracted from the model object as well.</p>
<p>In this example we used the Extended Kalman filter (this is the
default filtering algorithm specified by the argument
<code>method="ekf"</code> to <code>estimate</code>). This method
produces <em>prior</em> and <em>posterior</em> state estimates. The
prior estimates are one-step-ahead predictions, while the posterior
estimated are these priors but updated against the current-time
available observations. The user is referred to the <a href="https://phillipbvetter.github.io/ctsmTMB/articles/extended_kalman_filter.html" class="external-link">Kalman
Filter vignette</a> for more information on the theoretical details.</p>
<p>The states can easily be plotted using the provided
<strong>S3</strong> plot.ctsmTMB.fit method. Here we plot both prior and
posterior states against the observations:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">"states"</span>,state.type<span class="op">=</span><span class="st">"prior"</span>,against<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span>, type<span class="op">=</span><span class="st">"states"</span>,state.type<span class="op">=</span><span class="st">"posterior"</span>,against<span class="op">=</span><span class="st">"y"</span><span class="op">)</span></span></code></pre></div>
<p><em><strong>Note:</strong> The decrease in variance for the posterior
state estimate is expected because these states are updated to the
observations.</em></p>
<!-- We can quickly perform a comparison with the *smoothed* state estimates from the `laplace` estimation method (we suppress the output): -->
<!-- ```{r, fig.height=5,fig.width=7, out.width="100%", fig.align='center'} -->
<!-- fit2 <- model$estimate(data, method="laplace", silent=TRUE, control=list(trace=0)) -->
<!-- plot(fit2, type="states", state.type="smoothed", against="y") -->
<!-- ``` -->
</div>
<div class="section level3">
<h3 id="residual-analysis">Residual analysis<a class="anchor" aria-label="anchor" href="#residual-analysis"></a>
</h3>
<hr>
<p>Model validation typically involves inspecting the properties of
prediction residuals. The model residuals are contained in
<code>fit$residuals</code> with the entries:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "residuals"  "sd"         "normalized" "cov"</span></span></code></pre>
<p>We can also easily generate a residual analysis plot with the
<strong>S3</strong> plot.ctsmTMB.fit method. This is actually the
default arguments to <code>plot.ctsmTMB.fit</code>. This produces a
time-series of the residuals, a histogram, a quantile-quantile plot,
auto/partial-correlations and a cumulative periodogram:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="profiling-the-likelihood">Profiling the likelihood<a class="anchor" aria-label="anchor" href="#profiling-the-likelihood"></a>
</h2>
<hr>
<p>We can perform likelihood profiling with the <code>profile</code> S3
method on the <code>fit</code> object, and further plot the result by
calling the <code>plot</code> S3 method on that.</p>
<p>For an example we can inspect the profile likelihood of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
as follows:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">par.fixed</span><span class="op">[</span><span class="st">"theta"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">3</span><span class="op">*</span><span class="va">fit</span><span class="op">$</span><span class="va">sd.fixed</span><span class="op">[</span><span class="st">"theta"</span><span class="op">]</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">par.fixed</span><span class="op">[</span><span class="st">"theta"</span><span class="op">]</span> <span class="op">+</span> <span class="fl">3</span><span class="op">*</span><span class="va">fit</span><span class="op">$</span><span class="va">sd.fixed</span><span class="op">[</span><span class="st">"theta"</span><span class="op">]</span></span>
<span><span class="va">prof</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/profile.html" class="external-link">profile</a></span><span class="op">(</span><span class="va">fit</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"theta"</span><span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>,length.out<span class="op">=</span><span class="fl">50</span><span class="op">)</span><span class="op">)</span>, silent<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">prof</span><span class="op">)</span></span></code></pre></div>
<p><img src="ctsmTMB_files/figure-html/unnamed-chunk-32-1.png" alt="The plot shows a profile likelihood of the theta parameter." width="100%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a &lt;- fit$par.fixed["mu"] - 8*fit$sd.fixed["mu"]</span></span>
<span><span class="co"># b &lt;- fit$par.fixed["mu"] + 8*fit$sd.fixed["mu"]</span></span>
<span><span class="co"># prof &lt;- profile(fit, list("mu"=seq(a,b,length.out=50)), silent=TRUE)</span></span>
<span><span class="co"># plot(prof)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># a &lt;- fit$par.fixed["theta"] - 5*fit$sd.fixed["theta"]</span></span>
<span><span class="co"># b &lt;- fit$par.fixed["theta"] + 5*fit$sd.fixed["theta"]</span></span>
<span><span class="co"># c &lt;- fit$par.fixed["mu"] - 10*fit$sd.fixed["mu"]</span></span>
<span><span class="co"># d &lt;- fit$par.fixed["mu"] + 10*fit$sd.fixed["mu"]</span></span>
<span><span class="co"># prof &lt;- profile(fit, list("theta"=seq(a,b,length.out=50),</span></span>
<span><span class="co">#                           "mu"=seq(c,d,length.out=50)), silent=TRUE)</span></span>
<span><span class="co"># plot(prof)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extra-algebraic-equations">
<strong>Extra:</strong> Algebraic equations<a class="anchor" aria-label="anchor" href="#extra-algebraic-equations"></a>
</h2>
<hr>
<p>The model definitions can be kept clean by defining algebraic
expressions which replace variables in the defined equations. A typical
scenario where algebraic equations can be used is to rename parameters
which must be strictly positive.</p>
<p><strong>Example</strong> In this model
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>
should be a strictly positive parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>log</mo><mi>θ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\hat{\theta} = \exp(\log\theta)</annotation></semantics></math>.
This can be achieved by setting the following algebraic expression:</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">setAlgebraics</span><span class="op">(</span><span class="va">theta</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">logtheta</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The effect of this is to replace all occurrences of
<code>theta</code> in the model equations with
<code>exp(logtheta)</code>. The final thing to do is to add a new
parameter entry to the model object which describes values for
<code>logtheta</code></p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span>logtheta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">5</span>, lower<span class="op">=</span><span class="fl">0</span>, upper<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
