<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Methods for the 'ctsmTMB' R6 class — ctsmTMB • ctsmTMB</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Mukta-0.4.10/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Methods for the 'ctsmTMB' R6 class — ctsmTMB"><meta name="description" content="The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state."><meta property="og:description" content="The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state."><meta property="og:image" content="https://github.com/phillipbvetter/ctsmTMB/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ctsmTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/ctsmTMB.html">Getting Started</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignettes" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Vignettes</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignettes"><li><a class="dropdown-item" href="../articles/estimate.html">Estimation</a></li>
    <li><a class="dropdown-item" href="../articles/predict.html">Prediction</a></li>
    <li><a class="dropdown-item" href="../articles/simulate.html">Simulation</a></li>
    <li><a class="dropdown-item" href="../articles/using_another_optimizer.html">Likelihood (Extracting Function Handlers)</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-math-details" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Math Details</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-math-details"><li><a class="dropdown-item" href="../articles/linear_kalman_filter.html">Linear Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/extended_kalman_filter.html">Extended Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/unscented_kalman_filter.html">Unscented Kalman Filter</a></li>
    <li><a class="dropdown-item" href="../articles/laplace_approx.html">Laplace "Filter"</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/phillipbvetter/ctsmTMB/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Methods for the 'ctsmTMB' R6 class</h1>
      <small class="dont-index">Source: <a href="https://github.com/phillipbvetter/ctsmTMB/blob/HEAD/R/ctsmTMB.R"><code>R/ctsmTMB.R</code></a></small>
      <div class="d-none name"><code>ctsmTMB.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state.</p>
    </div>


    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The function returns an object of class <code>R6</code> and <code>ctsmTMB</code>,
which can be used to define a stochastic state space system.</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>

<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-ctsmTMB-new"><code>ctsmTMB$new()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-.private"><code>ctsmTMB$.private()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getPrivateFields"><code>ctsmTMB$getPrivateFields()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getPrivate"><code>ctsmTMB$getPrivate()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setTrainingMethod"><code>ctsmTMB$setTrainingMethod()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-addSystem"><code>ctsmTMB$addSystem()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-addObs"><code>ctsmTMB$addObs()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setVariance"><code>ctsmTMB$setVariance()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-addInput"><code>ctsmTMB$addInput()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setParameter"><code>ctsmTMB$setParameter()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setAlgebraics"><code>ctsmTMB$setAlgebraics()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setInitialState"><code>ctsmTMB$setInitialState()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setInitialVarianceScaling"><code>ctsmTMB$setInitialVarianceScaling()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setLamperti"><code>ctsmTMB$setLamperti()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setModelname"><code>ctsmTMB$setModelname()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setMAP"><code>ctsmTMB$setMAP()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-setAdvancedSettings"><code>ctsmTMB$setAdvancedSettings()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getSystems"><code>ctsmTMB$getSystems()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getObservations"><code>ctsmTMB$getObservations()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getVariances"><code>ctsmTMB$getVariances()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getAlgebraics"><code>ctsmTMB$getAlgebraics()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getInitialState"><code>ctsmTMB$getInitialState()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getParameters"><code>ctsmTMB$getParameters()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getTimers"><code>ctsmTMB$getTimers()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getEstimate"><code>ctsmTMB$getEstimate()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getLikelihood"><code>ctsmTMB$getLikelihood()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getPrediction"><code>ctsmTMB$getPrediction()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-getSimulation"><code>ctsmTMB$getSimulation()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-filter"><code>ctsmTMB$filter()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-smoother"><code>ctsmTMB$smoother()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-estimate"><code>ctsmTMB$estimate()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-likelihood"><code>ctsmTMB$likelihood()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-predict"><code>ctsmTMB$predict()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-simulate"><code>ctsmTMB$simulate()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-print"><code>ctsmTMB$print()</code></a></p></li>
<li><p><a href="#method-ctsmTMB-clone"><code>ctsmTMB$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-ctsmTMB-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Initialize private fields</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/ctsmTMB.html">ctsmTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-.private"></a><div class="section">
<h3 id="method-private-">Method <code>.private()</code><a class="anchor" aria-label="anchor" href="#method-private-"></a></h3>
<p>Extract the private fields of a ctsmTMB model object.
Primarily used for debugging.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">.private</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getPrivateFields"></a><div class="section">
<h3 id="method-getprivatefields-">Method <code>getPrivateFields()</code><a class="anchor" aria-label="anchor" href="#method-getprivatefields-"></a></h3>
<p>Extract the private fields of a ctsmTMB model object.
Primarily used for debugging.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getPrivateFields</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getPrivate"></a><div class="section">
<h3 id="method-getprivate-">Method <code>getPrivate()</code><a class="anchor" aria-label="anchor" href="#method-getprivate-"></a></h3>
<p>Extract the private fields of a ctsmTMB model object.
Primarily used for debugging.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getPrivate</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-setTrainingMethod"></a><div class="section">
<h3 id="method-settrainingmethod-">Method <code>setTrainingMethod()</code><a class="anchor" aria-label="anchor" href="#method-settrainingmethod-"></a></h3>
<p>Set training method</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setTrainingMethod</span><span class="op">(</span><span class="va">full.prediction</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>full.prediction</code></dt>
<dd><p>boolean whether or not to train against a full prediction
over the data, rather than 1-step predictions</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-addSystem"></a><div class="section">
<h3 id="method-addsystem-">Method <code>addSystem()</code><a class="anchor" aria-label="anchor" href="#method-addsystem-"></a></h3>
<p>Define stochastic differential equation(s) on the form</p>
<p><code>d&lt;state&gt; ~ f(t,&lt;states&gt;, &lt;inputs&gt;) * dt + g(t, &lt;states&gt;, &lt;inputs&gt;) * dw</code></p><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">addSystem</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>a formula specifying a stochastic differential equation</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying
multiple equations at once.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-addObs"></a><div class="section">
<h3 id="method-addobs-">Method <code>addObs()</code><a class="anchor" aria-label="anchor" href="#method-addobs-"></a></h3>
<p>Define algebraic observation equations on the form</p>
<p><code>&lt;observation&gt; ~ h(t, &lt;states&gt;, &lt;inputs&gt;) + e)</code></p>
<p>where <code>h</code> is the observation function, and <code>e</code> is normally
distributed noise with zero mean.</p>
<p>This function only specifies the observation name, and its mean through <code>h</code>.</p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">addObs</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span>, obsnames <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>a formula specifying an observation equation</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying
multiple equations at once.</p></dd>


<dt><code>obsnames</code></dt>
<dd><p>character vector specifying the name of the observation.
This is used when the left-hand side of <code>form</code> consists of more than just
a single variable (of class 'call').</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setVariance"></a><div class="section">
<h3 id="method-setvariance-">Method <code>setVariance()</code><a class="anchor" aria-label="anchor" href="#method-setvariance-"></a></h3>
<p>Specify the variance of an observation equation.</p>
<p>A defined observation variable <code>y</code> in e.g. <code>addObs(y ~
h(t,&lt;states&gt;,&lt;inputs&gt;)</code> is perturbed by Gaussian noise with zero mean and
variance
to-be specified using <code>setVariance(y ~ p(t,&lt;states&gt;,&lt;inputs&gt;)</code>.
We can for instance declare <code>setVariance(y ~ sigma_x^2</code>
where <code>sigma_x</code> is a fixed effect parameter to be declared through
<code>setParameter</code>.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setVariance</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula class specifying the observation equation to be added
to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas identical to <code>form</code> to specify multiple
observation equations at a time.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-addInput"></a><div class="section">
<h3 id="method-addinput-">Method <code>addInput()</code><a class="anchor" aria-label="anchor" href="#method-addinput-"></a></h3>
<p>Declare variables as data inputs</p>
<p>Declare whether a variable contained in system, observation or observation
variance equations is an input variable. If e.g. the system equation contains
an input variable <code>u</code> then it is declared using <code>addInput(u)</code>.
The input <code>u</code> must be contained in the data.frame <code>.data</code> provided
when calling the <code>estimate</code> or <code>predict</code> methods.</p><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">addInput</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>variable names that specifies the name of input variables in the defined system.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setParameter"></a><div class="section">
<h3 id="method-setparameter-">Method <code>setParameter()</code><a class="anchor" aria-label="anchor" href="#method-setparameter-"></a></h3>
<p>Declare which variables that are (fixed effects) parameters in
the specified model, and specify the initial optimizer guess, as well as
lower / upper bounds during optimization. There are two ways to declare parameters:</p><ol><li><p>You can declare parameters using formulas i.e. <code>setParameter(
theta = c(1,0,10), mu = c(0,-10,10) )</code>. The first value is the initial
value for the optimizer, the second value is the lower optimization
bound and the third value is the upper optimization bound.</p></li>
<li><p>You can provide a 3-column matrix where rows corresponds to different
parameters, and the parameter names are provided as rownames of the matrix.
The columns values corresponds to the description in the vector format above.</p></li>
</ol><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>a named vector or matrix as described above.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setAlgebraics"></a><div class="section">
<h3 id="method-setalgebraics-">Method <code>setAlgebraics()</code><a class="anchor" aria-label="anchor" href="#method-setalgebraics-"></a></h3>
<p>Add algebraic relations.</p>
<p>Algebraic relations is a convenient way to transform parameters in your equations.
In the Ornstein-Uhlenbeck process the rate parameter <code>theta</code> is always positive, so
estimation in the log-domain is a good idea. Instead of writing <code>exp(theta)</code> directly
in the system equation one can transform into the log domain using the algebraic relation
<code>setAlgebraics(theta ~ exp(logtheta))</code>. All instances of <code>theta</code> is replaced
by <code>exp(logtheta)</code> when compiling the C++ function. Note that you must provide values
for <code>logtheta</code> now instead of <code>theta</code> when declaring parameters through
<code>setParameter</code></p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setAlgebraics</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>algebraic formula</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setInitialState"></a><div class="section">
<h3 id="method-setinitialstate-">Method <code>setInitialState()</code><a class="anchor" aria-label="anchor" href="#method-setinitialstate-"></a></h3>
<p>Declare the initial state values i.e. mean and covariance for the system states.</p><div class="section">
<h4 id="usage-11">Usage<a class="anchor" aria-label="anchor" href="#usage-11"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setInitialState</span><span class="op">(</span><span class="va">initial.state</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setInitialVarianceScaling"></a><div class="section">
<h3 id="method-setinitialvariancescaling-">Method <code>setInitialVarianceScaling()</code><a class="anchor" aria-label="anchor" href="#method-setinitialvariancescaling-"></a></h3>
<p>A scalar value that is multiplied onto the estimated
initial state covariance matrix. The scaling is only applied when the
initial state/cov is estimated, not when it is set by the user.</p><div class="section">
<h4 id="usage-12">Usage<a class="anchor" aria-label="anchor" href="#usage-12"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setInitialVarianceScaling</span><span class="op">(</span><span class="va">scaling</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>scaling</code></dt>
<dd><p>a numeric scalar value.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setLamperti"></a><div class="section">
<h3 id="method-setlamperti-">Method <code>setLamperti()</code><a class="anchor" aria-label="anchor" href="#method-setlamperti-"></a></h3>
<p>Set a Lamperti Transformation</p>
<p>If the provided system equations have state dependent diffusion in a few available ways
then it is advantageous to perform a transformation to remove the state dependence. This
comes at the cost of a more complicated drift function. The following types of state-dependence
is currently supported</p><ol><li><p>'identity' - when the diffusion is state-independent (default)</p></li>
<li><p>'log' - when the diffusion is proportional to to x * dw</p></li>
<li><p>'logit' - when the diffusion is proportional to x * (1-x) * dw</p></li>
<li><p>'sqrt-logit' - when the diffusion is proportional to sqrt(x * (1-x)) * dw</p></li>
</ol><div class="section">
<h4 id="usage-13">Usage<a class="anchor" aria-label="anchor" href="#usage-13"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setLamperti</span><span class="op">(</span><span class="va">transforms</span>, states <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>transforms</code></dt>
<dd><p>character vector - one of either "identity, "log", "logit", "sqrt-logit"</p></dd>


<dt><code>states</code></dt>
<dd><p>a vector of the state names for which the specified transformations should be applied to.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setModelname"></a><div class="section">
<h3 id="method-setmodelname-">Method <code>setModelname()</code><a class="anchor" aria-label="anchor" href="#method-setmodelname-"></a></h3>
<p>Set modelname used to create the C++ file for TMB</p>
<p>When calling <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun</a></code> the (negative log) likelihood function
is created in the directory specified by the <code>setCppfilesDirectory</code>
method with name <code>&lt;modelname&gt;.cpp</code></p><div class="section">
<h4 id="usage-14">Usage<a class="anchor" aria-label="anchor" href="#usage-14"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setModelname</span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>
<p></p><div class="arguments"><dl><dt><code>name</code></dt>
<dd><p>string defining the model name.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setMAP"></a><div class="section">
<h3 id="method-setmap-">Method <code>setMAP()</code><a class="anchor" aria-label="anchor" href="#method-setmap-"></a></h3>
<p>Enable maximum a posterior (MAP) estimation.</p>
<p>Adds a maximum a posterior contribution to the (negative log) likelihood
function by  evaluating the fixed effects parameters in a multivariate Gaussian
with <code>mean</code> and <code>covariance</code> as provided.</p><div class="section">
<h4 id="usage-15">Usage<a class="anchor" aria-label="anchor" href="#usage-15"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setMAP</span><span class="op">(</span><span class="va">mean</span>, <span class="va">cov</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>
<p></p><div class="arguments"><dl><dt><code>mean</code></dt>
<dd><p>mean vector of the Gaussian prior parameter distribution</p></dd>


<dt><code>cov</code></dt>
<dd><p>covariance matrix of the Gaussian prior parameter distribution</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-setAdvancedSettings"></a><div class="section">
<h3 id="method-setadvancedsettings-">Method <code>setAdvancedSettings()</code><a class="anchor" aria-label="anchor" href="#method-setadvancedsettings-"></a></h3>
<p>Enable maximum a posterior (MAP) estimation.</p>
<p>Adds a maximum a posterior contribution to the (negative log) likelihood
function by  evaluating the fixed effects parameters in a multivariate Gaussian
with <code>mean</code> and <code>covariance</code> as provided.</p><div class="section">
<h4 id="usage-16">Usage<a class="anchor" aria-label="anchor" href="#usage-16"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">setAdvancedSettings</span><span class="op">(</span></span>
<span>  force.ad <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  rtmb.tapeconfig <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tmb.tapeconfig <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>
<p></p><div class="arguments"><dl><dt><code>force.ad</code></dt>
<dd><p>a boolean indicating whether to use state space functions that take advantage of the
RTMB::AD(...,force=TRUE) hack which reduces compilation time call to MakeADFun by 20%. This breaks
some functionalities such as REPORT.</p></dd>


<dt><code>rtmb.tapeconfig</code></dt>
<dd><p>options to be passed to <a href="https://rdrr.io/pkg/RTMB/man/Tape.html" class="external-link">TapeConfig</a>.</p></dd>


<dt><code>tmb.tapeconfig</code></dt>
<dd><p>options to be passed to <a href="https://rdrr.io/pkg/TMB/man/config.html" class="external-link">config</a>.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-getSystems"></a><div class="section">
<h3 id="method-getsystems-">Method <code>getSystems()</code><a class="anchor" aria-label="anchor" href="#method-getsystems-"></a></h3>
<p>Retrieve system equations.</p><div class="section">
<h4 id="usage-17">Usage<a class="anchor" aria-label="anchor" href="#usage-17"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getSystems</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getObservations"></a><div class="section">
<h3 id="method-getobservations-">Method <code>getObservations()</code><a class="anchor" aria-label="anchor" href="#method-getobservations-"></a></h3>
<p>Retrieve observation equations.</p><div class="section">
<h4 id="usage-18">Usage<a class="anchor" aria-label="anchor" href="#usage-18"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getObservations</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getVariances"></a><div class="section">
<h3 id="method-getvariances-">Method <code>getVariances()</code><a class="anchor" aria-label="anchor" href="#method-getvariances-"></a></h3>
<p>Retrieve observation variances</p><div class="section">
<h4 id="usage-19">Usage<a class="anchor" aria-label="anchor" href="#usage-19"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getVariances</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getAlgebraics"></a><div class="section">
<h3 id="method-getalgebraics-">Method <code>getAlgebraics()</code><a class="anchor" aria-label="anchor" href="#method-getalgebraics-"></a></h3>
<p>Retrieve algebraic relations</p><div class="section">
<h4 id="usage-20">Usage<a class="anchor" aria-label="anchor" href="#usage-20"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getAlgebraics</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getInitialState"></a><div class="section">
<h3 id="method-getinitialstate-">Method <code>getInitialState()</code><a class="anchor" aria-label="anchor" href="#method-getinitialstate-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-21">Usage<a class="anchor" aria-label="anchor" href="#usage-21"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getParameters"></a><div class="section">
<h3 id="method-getparameters-">Method <code>getParameters()</code><a class="anchor" aria-label="anchor" href="#method-getparameters-"></a></h3>
<p>Get initial (and estimated) parameters.</p><div class="section">
<h4 id="usage-22">Usage<a class="anchor" aria-label="anchor" href="#usage-22"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getParameters</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"all"</span>, value <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>
<p></p><div class="arguments"><dl><dt><code>type</code></dt>
<dd><p>one of "all", free" or "fixed" parameters.</p></dd>


<dt><code>value</code></dt>
<dd><p>one of "all", initial", "estimate", "lower" or "upper"</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-getTimers"></a><div class="section">
<h3 id="method-gettimers-">Method <code>getTimers()</code><a class="anchor" aria-label="anchor" href="#method-gettimers-"></a></h3>
<p>Retrieve initially timers</p><div class="section">
<h4 id="usage-23">Usage<a class="anchor" aria-label="anchor" href="#usage-23"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getTimers</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getEstimate"></a><div class="section">
<h3 id="method-getestimate-">Method <code>getEstimate()</code><a class="anchor" aria-label="anchor" href="#method-getestimate-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-24">Usage<a class="anchor" aria-label="anchor" href="#usage-24"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getEstimate</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getLikelihood"></a><div class="section">
<h3 id="method-getlikelihood-">Method <code>getLikelihood()</code><a class="anchor" aria-label="anchor" href="#method-getlikelihood-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-25">Usage<a class="anchor" aria-label="anchor" href="#usage-25"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getLikelihood</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getPrediction"></a><div class="section">
<h3 id="method-getprediction-">Method <code>getPrediction()</code><a class="anchor" aria-label="anchor" href="#method-getprediction-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-26">Usage<a class="anchor" aria-label="anchor" href="#usage-26"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getPrediction</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-getSimulation"></a><div class="section">
<h3 id="method-getsimulation-">Method <code>getSimulation()</code><a class="anchor" aria-label="anchor" href="#method-getsimulation-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-27">Usage<a class="anchor" aria-label="anchor" href="#usage-27"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">getSimulation</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-filter"></a><div class="section">
<h3 id="method-filter-">Method <code><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter()</a></code><a class="anchor" aria-label="anchor" href="#method-filter-"></a></h3>
<p>Perform state filtering (or smoothing for the 'laplace' method)</p><div class="section">
<h4 id="usage-28">Usage<a class="anchor" aria-label="anchor" href="#usage-28"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ukf.hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  laplace.residuals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  use.cpp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-14">Arguments<a class="anchor" aria-label="anchor" href="#arguments-14"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>setParameter</code>, unless the <code>estimate</code></p></dd>


<dt><code>method</code></dt>
<dd><p>character vector specifying the filtering method used for state/likelihood calculations.
Must be one of either "lkf", "ekf", "laplace".</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residuals as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approximation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>ukf.hyperpars</code></dt>
<dd><p>The hyperparameters alpha, beta, and kappa used for sigma points and weights construction in the Unscented Kalman Filter.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>laplace.residuals</code></dt>
<dd><p>boolean - whether or not to calculate one-step ahead residuals
using the method of <a href="https://rdrr.io/pkg/TMB/man/oneStepPredict.html" class="external-link">oneStepPredict</a>.</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>boolean value. When TRUE the initial state and covariance matrices are
estimated as the stationary solution of the linearized mean and covariance differential equations. When the
system contains time-varying inputs, the first element of these is used.</p></dd>


<dt><code>use.cpp</code></dt>
<dd><p>a boolean to indicate whether to use C++ to perform calculations</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-smoother"></a><div class="section">
<h3 id="method-smoother-">Method <code>smoother()</code><a class="anchor" aria-label="anchor" href="#method-smoother-"></a></h3>
<p>Perform state filtering (or smoothing for the 'laplace' method)</p><div class="section">
<h4 id="usage-29">Usage<a class="anchor" aria-label="anchor" href="#usage-29"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">smoother</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"euler"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  laplace.residuals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-15">Arguments<a class="anchor" aria-label="anchor" href="#arguments-15"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>setParameter</code>, unless the <code>estimate</code></p></dd>


<dt><code>method</code></dt>
<dd><p>character vector specifying the filtering method used for state/likelihood calculations.
Must be one of either "lkf", "ekf", "laplace".</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residuals as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approximation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>laplace.residuals</code></dt>
<dd><p>boolean - whether or not to calculate one-step ahead residuals
using the method of <a href="https://rdrr.io/pkg/TMB/man/oneStepPredict.html" class="external-link">oneStepPredict</a>.</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>boolean value. When TRUE the initial state and covariance matrices are
estimated as the stationary solution of the linearized mean and covariance differential equations. When the
system contains time-varying inputs, the first element of these is used.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-estimate"></a><div class="section">
<h3 id="method-estimate-">Method <code>estimate()</code><a class="anchor" aria-label="anchor" href="#method-estimate-"></a></h3>
<p>Estimate the fixed effects parameters in the specified model.</p><div class="section">
<h4 id="usage-30">Usage<a class="anchor" aria-label="anchor" href="#usage-30"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ukf.hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  trace <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="va">trace</span>, iter.max <span class="op">=</span> <span class="fl">1e+05</span>, eval.max <span class="op">=</span> <span class="fl">1e+05</span><span class="op">)</span>,</span>
<span>  use.hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  report <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  laplace.residuals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  unconstrained.optim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-16">Arguments<a class="anchor" aria-label="anchor" href="#arguments-16"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector specifying the filtering method used for state/likelihood calculations.
Must be one of either "lkf", "ekf", "laplace".</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residuals as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approximation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>ukf.hyperpars</code></dt>
<dd><p>The hyperparameters alpha, beta, and kappa used for sigma points and weights construction in the Unscented Kalman Filter.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>trace</code></dt>
<dd><p>integer passed to <code>control</code> which determines number of steps between each print-out
during optimization (use 0 to disable tracing print-outs).</p></dd>


<dt><code>control</code></dt>
<dd><p>list of control parameters parsed to <code>nlminb</code> as its <code>control</code> argument.
See <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">?stats::nlminb</a></code> for more information</p></dd>


<dt><code>use.hessian</code></dt>
<dd><p>boolean value. The default (<code>TRUE</code>) causes the optimization algorithm
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb</a></code> to use the fixed effects hessian of the (negative log) likelihood when
performing the optimization. This feature is only available for the kalman filter methods
without any random effects.</p></dd>


<dt><code>report</code></dt>
<dd><p>boolean - whether or not to report filtered states, observations and residuals.</p></dd>


<dt><code>laplace.residuals</code></dt>
<dd><p>boolean - whether or not to calculate one-step ahead residuals
using the method of <a href="https://rdrr.io/pkg/TMB/man/oneStepPredict.html" class="external-link">oneStepPredict</a>.</p></dd>


<dt><code>unconstrained.optim</code></dt>
<dd><p>boolean value. When TRUE then the optimization is carried out unconstrained i.e.
without any of the parameter bounds specified during <code>setParameter</code>.</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>boolean value. When TRUE the initial state and covariance matrices are
estimated as the stationary solution of the linearized mean and covariance differential equations. When the
system contains time-varying inputs, the first element of these is used.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean for (re)compiling the objective C++ file, used for methods ending with <code>_cpp</code>.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-likelihood"></a><div class="section">
<h3 id="method-likelihood-">Method <code>likelihood()</code><a class="anchor" aria-label="anchor" href="#method-likelihood-"></a></h3>
<p>Construct and extract function handlers for the negative
log likelihood function.</p>
<p>The handlers from <code>TMB</code>'s <code>MakeADFun</code> are constructed and returned.
This enables the user to e.g. choose their own optimization algorithm, or just
have more control of the optimization workflow.</p><div class="section">
<h4 id="usage-31">Usage<a class="anchor" aria-label="anchor" href="#usage-31"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">likelihood</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ukf.hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-17">Arguments<a class="anchor" aria-label="anchor" href="#arguments-17"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>a data.frame containing time-vector 't', observations and inputs.
The observations can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector specifying the filtering method used for state/likelihood calculations.
Must be one of either "lkf", "ekf", "laplace".</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>the time-step used in the filtering schemes. The
time-step has two different uses depending on the chosen method.</p><ol><li><p>Kalman Filters: The time-step is used when numerically solving the
moment differential equations.</p></li>
<li><p>Laplace Approximation: The time-step is used in the Euler-Maruyama
simulation scheme for simulating a sample path of the stochastic differential
equation, which serves to link together the latent (random effects) states.</p></li>
</ol><p>The defined step-size is used to calculate the number of steps between
observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residuals as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approximation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>ukf.hyperpars</code></dt>
<dd><p>The hyperparameters alpha, beta, and kappa used for sigma points and weights construction in the Unscented Kalman Filter.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>boolean value. When TRUE the initial state and covariance matrices are
estimated as the stationary solution of the linearized mean and covariance differential equations. When the
system contains time-varying inputs, the first element of these is used.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean for (re)compiling the objective C++ file, used for methods ending with <code>_cpp</code>.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-ctsmTMB-predict"></a><div class="section">
<h3 id="method-predict-">Method <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code><a class="anchor" aria-label="anchor" href="#method-predict-"></a></h3>
<p>Perform prediction/filtration to obtain state mean and covariance estimates. The predictions are
obtained by solving the moment equations <code>n.ahead</code> steps forward in time when using the current step posterior
state estimate as the initial condition.</p><div class="section">
<h4 id="usage-32">Usage<a class="anchor" aria-label="anchor" href="#usage-32"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  k.ahead <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  return.k.ahead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">k.ahead</span>,</span>
<span>  return.covariance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ukf.hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">estimate.initial</span>,</span>
<span>  use.cpp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-18">Arguments<a class="anchor" aria-label="anchor" href="#arguments-18"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>setParameter</code>, unless the <code>estimate</code>
function has been run, then the default values will be those at the found optimum.</p></dd>


<dt><code>method</code></dt>
<dd><p>The prediction method</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>k.ahead</code></dt>
<dd><p>integer specifying the desired number of time-steps (as determined by the provided
data time-vector) for which predictions are made (integrating the moment ODEs forward in time without
data updates).</p></dd>


<dt><code>return.k.ahead</code></dt>
<dd><p>numeric vector of integers specifying which n.ahead predictions to that
should be returned.</p></dd>


<dt><code>return.covariance</code></dt>
<dd><p>boolean value to indicate whether the covariance (instead of the correlation)
should be returned.</p></dd>


<dt><code>ukf.hyperpars</code></dt>
<dd><p>The hyperparameters alpha, beta, and kappa used for sigma points and weights construction in the Unscented Kalman Filter.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>bool - stationary estimation of initial mean and covariance</p></dd>


<dt><code>use.cpp</code></dt>
<dd><p>a boolean to indicate whether to use C++ to perform calculations</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A data.frame that contains for each time step the posterior state estimate at that time.step (<code>k = 0</code>), and the
prior state predictions (<code>k = 1,...,n.ahead</code>). If <code>return.covariance = TRUE</code> then the state covariance/correlation
matrix is returned, otherwise only the marginal variances are returned.</p>
</div>

</div><p></p><hr><a id="method-ctsmTMB-simulate"></a><div class="section">
<h3 id="method-simulate-">Method <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code><a class="anchor" aria-label="anchor" href="#method-simulate-"></a></h3>
<p>Perform prediction/filtration to obtain state mean and covariance estimates. The predictions are
obtained by solving the moment equations <code>n.ahead</code> steps forward in time when using the current step posterior
state estimate as the initial condition.</p><div class="section">
<h4 id="usage-33">Usage<a class="anchor" aria-label="anchor" href="#usage-33"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use.cpp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cpp.seed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  simulation.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  k.ahead <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>  return.k.ahead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">k.ahead</span>,</span>
<span>  n.sims <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  ukf.hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">getInitialState</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  estimate.initial.state <span class="op">=</span> <span class="va">private</span><span class="op">$</span><span class="va">estimate.initial</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-19">Arguments<a class="anchor" aria-label="anchor" href="#arguments-19"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>setParameter</code>, unless the <code>estimate</code>
function has been run, then the default values will be those at the found optimum.</p></dd>


<dt><code>use.cpp</code></dt>
<dd><p>a boolean to indicate whether to use C++ to perform calculations</p></dd>


<dt><code>cpp.seed</code></dt>
<dd><p>an integer seed value to control RNG normal draws on the C++ side.</p></dd>


<dt><code>method</code></dt>
<dd><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continuous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continuous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the Jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>simulation.timestep</code></dt>
<dd><p>timestep used in the euler-maruyama scheme</p></dd>


<dt><code>k.ahead</code></dt>
<dd><p>integer specifying the desired number of time-steps (as determined by the provided
data time-vector) for which predictions are made (integrating the moment ODEs forward in time without
data updates).</p></dd>


<dt><code>return.k.ahead</code></dt>
<dd><p>numeric vector of integers specifying which n.ahead predictions to that
should be returned.</p></dd>


<dt><code>n.sims</code></dt>
<dd><p>number of simulations</p></dd>


<dt><code>ukf.hyperpars</code></dt>
<dd><p>The hyperparameters alpha, beta, and kappa used for sigma points and weights construction in the Unscented Kalman Filter.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>estimate.initial.state</code></dt>
<dd><p>bool - stationary estimation of initial mean and covariance</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional arguments</p></dd>


<dt><code>return.covariance</code></dt>
<dd><p>boolean value to indicate whether the covariance (instead of the correlation)
should be returned.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>A data.frame that contains for each time step the posterior state estimate at that time.step (<code>k = 0</code>), and the
prior state predictions (<code>k = 1,...,n.ahead</code>). If <code>return.covariance = TRUE</code> then the state covariance/correlation
matrix is returned, otherwise only the marginal variances are returned.</p>
</div>

</div><p></p><hr><a id="method-ctsmTMB-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Function to print the model object</p><div class="section">
<h4 id="usage-34">Usage<a class="anchor" aria-label="anchor" href="#usage-34"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-ctsmTMB-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-35">Usage<a class="anchor" aria-label="anchor" href="#usage-35"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-20">Arguments<a class="anchor" aria-label="anchor" href="#arguments-20"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/phillipbvetter/ctsmTMB">ctsmTMB</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">ctsmTMB</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># adding a single system equations</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">addSystem</span><span class="op">(</span><span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span><span class="op">+</span><span class="va">u</span><span class="op">-</span><span class="va">x</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma_x</span><span class="op">*</span><span class="va">dw</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># adding an observation equation and setting variance</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">addObs</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">setVariance</span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">sigma_y</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add model input</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">addInput</span><span class="op">(</span><span class="va">u</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add parameters</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">setParameter</span><span class="op">(</span></span></span>
<span class="r-in"><span>  theta   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial <span class="op">=</span> <span class="fl">1</span>, lower<span class="op">=</span><span class="fl">1e-5</span>, upper<span class="op">=</span><span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  mu      <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">1.5</span>, lower<span class="op">=</span><span class="fl">0</span>, upper<span class="op">=</span><span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sigma_x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>initial<span class="op">=</span><span class="fl">1</span>, lower<span class="op">=</span><span class="fl">1e-10</span>, upper<span class="op">=</span><span class="fl">30</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sigma_y <span class="op">=</span> <span class="fl">1e-2</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># set the model initial state</span></span></span>
<span class="r-in"><span><span class="va">model</span><span class="op">$</span><span class="fu">setInitialState</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1e-1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract the likelihood handlers</span></span></span>
<span class="r-in"><span><span class="va">nll</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">likelihood</span><span class="op">(</span>data<span class="op">=</span><span class="va">Ornstein</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking model components...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking and setting data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Constructing objective function and derivative tables...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># calculate likelihood, gradient and hessian w.r.t parameters</span></span></span>
<span class="r-in"><span><span class="va">nll</span><span class="op">$</span><span class="fu">fn</span><span class="op">(</span><span class="va">nll</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 160.3533</span>
<span class="r-in"><span><span class="va">nll</span><span class="op">$</span><span class="fu">gr</span><span class="op">(</span><span class="va">nll</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]      [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 31.37158 -38.64846 -191.7731</span>
<span class="r-in"><span><span class="va">nll</span><span class="op">$</span><span class="fu">he</span><span class="op">(</span><span class="va">nll</span><span class="op">$</span><span class="va">par</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           [,1]      [,2]      [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  45.81706 -66.59203 -82.08423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -66.59203  19.98320  77.29517</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] -82.08423  77.29517 972.62925</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># estimate the parameters using an extended kalman filter</span></span></span>
<span class="r-in"><span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span>data<span class="op">=</span><span class="va">Ornstein</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Minimizing the negative log-likelihood...</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0:     160.35328:  1.00000  1.50000  1.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  10:     89.603625:  2.58436  2.91384  1.15608</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> 	 Optimization finished!:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             Elapsed time: 0.008 seconds.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             The objective value is: 7.387879e+01</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             The maximum gradient component is: 9.9e-08</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             The convergence message is: relative convergence (4)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             Iterations: 19</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             Evaluations: Fun: 29 Grad: 20</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>             See stats::nlminb for available tolerance/control arguments.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Returning results...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform moment predictions</span></span></span>
<span class="r-in"><span><span class="va">pred</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span>data<span class="op">=</span><span class="va">Ornstein</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking and setting data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Predicting with R...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Returning results...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished!</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform stochatic simulations</span></span></span>
<span class="r-in"><span><span class="va">sim</span> <span class="op">&lt;-</span> <span class="va">model</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>data<span class="op">=</span><span class="va">Ornstein</span>, n.sims<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Checking and setting data...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Simulating with R...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Returning results...</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Finished.</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

