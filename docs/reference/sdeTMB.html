<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state."><title>Methods for the 'sdeTMB' R6 class — sdeTMB • sdeTMB</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Mukta-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Methods for the 'sdeTMB' R6 class — sdeTMB"><meta property="og:description" content="The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">sdeTMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../articles/sdeTMB.html">Get started</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/construct_nll.html">construct_nll: How to extract function handlers, and choosing your own optimizer</a>
    <a class="dropdown-item" href="../articles/estimate.html">estimate: Estimating model parameters and states</a>
    <a class="dropdown-item" href="../articles/observation_equations.html">observations: Using functions on the left-hand side</a>
    <a class="dropdown-item" href="../articles/predict.html">predict: Forecasting the model states and observations.</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/phillipbvetter/sdeTMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Methods for the 'sdeTMB' R6 class</h1>
      <small class="dont-index">Source: <a href="https://github.com/phillipbvetter/sdeTMB/blob/HEAD/R/sdeTMB.R" class="external-link"><code>R/sdeTMB.R</code></a></small>
      <div class="d-none name"><code>sdeTMB.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The following public methods are used to construct a stochastic state space model
system, consisting of a set of stochastic differential equations (SDEs), and one or more algebraic observation
equations (AOEs). The AOEs are used to infer information about the value of the (latent) states governed by the SDEs, and
thus must be functions of at least one state.</p>
    </div>


    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>The function returns an object of class <code>R6</code> and <code>sdeTMB</code>,
which can be used to define a stochastic state space system.</p>
    </div>
    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    
<div class="section">
<h3 id="public-methods">Public methods<a class="anchor" aria-label="anchor" href="#public-methods"></a></h3>

<ul><li><p><a href="#method-sdeTMB-new"><code>sdeTMB$new()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_systems"><code>sdeTMB$add_systems()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_observations"><code>sdeTMB$add_observations()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_observation_variances"><code>sdeTMB$add_observation_variances()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_inputs"><code>sdeTMB$add_inputs()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_parameters"><code>sdeTMB$add_parameters()</code></a></p></li>
<li><p><a href="#method-sdeTMB-add_algebraics"><code>sdeTMB$add_algebraics()</code></a></p></li>
<li><p><a href="#method-sdeTMB-set_initial_state"><code>sdeTMB$set_initial_state()</code></a></p></li>
<li><p><a href="#method-sdeTMB-set_lamperti"><code>sdeTMB$set_lamperti()</code></a></p></li>
<li><p><a href="#method-sdeTMB-set_modelname"><code>sdeTMB$set_modelname()</code></a></p></li>
<li><p><a href="#method-sdeTMB-set_cppfile_directory"><code>sdeTMB$set_cppfile_directory()</code></a></p></li>
<li><p><a href="#method-sdeTMB-set_map"><code>sdeTMB$set_map()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_systems"><code>sdeTMB$get_systems()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_observations"><code>sdeTMB$get_observations()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_observation_variances"><code>sdeTMB$get_observation_variances()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_algebraics"><code>sdeTMB$get_algebraics()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_initial_state"><code>sdeTMB$get_initial_state()</code></a></p></li>
<li><p><a href="#method-sdeTMB-get_parameters"><code>sdeTMB$get_parameters()</code></a></p></li>
<li><p><a href="#method-sdeTMB-construct_nll"><code>sdeTMB$construct_nll()</code></a></p></li>
<li><p><a href="#method-sdeTMB-estimate"><code>sdeTMB$estimate()</code></a></p></li>
<li><p><a href="#method-sdeTMB-simulate"><code>sdeTMB$simulate()</code></a></p></li>
<li><p><a href="#method-sdeTMB-predict"><code>sdeTMB$predict()</code></a></p></li>
<li><p><a href="#method-sdeTMB-print"><code>sdeTMB$print()</code></a></p></li>
<li><p><a href="#method-sdeTMB-summary"><code>sdeTMB$summary()</code></a></p></li>
<li><p><a href="#method-sdeTMB-plot"><code>sdeTMB$plot()</code></a></p></li>
<li><p><a href="#method-sdeTMB-clone"><code>sdeTMB$clone()</code></a></p></li>
</ul></div><p></p><hr><a id="method-sdeTMB-new"></a><div class="section">
<h3 id="method-new-">Method <code>new()</code><a class="anchor" aria-label="anchor" href="#method-new-"></a></h3>
<p>Initialize private fields</p><div class="section">
<h4 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va"><a href="../reference/sdeTMB.html">sdeTMB</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-add_systems"></a><div class="section">
<h3 id="method-add-systems-">Method <code><a href="add_systems.html">add_systems()</a></code><a class="anchor" aria-label="anchor" href="#method-add-systems-"></a></h3>
<p>Define and add multiple stochastic differential equation governing the
process of individual state variables on the form</p>
<p><code>d&lt;state&gt; ~ f(t,&lt;states&gt;,&lt;inputs&gt;) * dt + g1(t,&lt;states&gt;,&lt;inputs&gt;) * dw1 
+ g2(t,&lt;states&gt;,&lt;inputs&gt;) * dw2 + ... + gN(t,&lt;states&gt;,&lt;inputs&gt;) * dwN</code></p>
<p>where <code>f</code> is the drift, and <code>g1, g2, ..., gN</code> are diffusions, with
differential brownian motions dw1, dw2, ..., dwN.</p><div class="section">
<h4 id="usage-1">Usage<a class="anchor" aria-label="anchor" href="#usage-1"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_systems</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula specifying the stochastic differential equation to be
added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying
multiple equations at once.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code><span><span class="co"># Specify Ornstein-Uhlenbeck Process</span></span>
<span><span class="fu"><a href="../reference/add_systems.html">add_systems</a></span><span class="op">(</span><span class="va">dx</span> <span class="op">~</span> <span class="va">theta</span> <span class="op">*</span> <span class="op">(</span><span class="va">mu</span> <span class="op">-</span> <span class="va">x</span> <span class="op">+</span> <span class="va">u</span><span class="op">)</span> <span class="op">*</span> <span class="va">dt</span> <span class="op">+</span> <span class="va">sigma</span> <span class="op">*</span> <span class="va">dw</span><span class="op">)</span></span>
<span>             </span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-add_observations"></a><div class="section">
<h3 id="method-add-observations-">Method <code><a href="add_observations.html">add_observations()</a></code><a class="anchor" aria-label="anchor" href="#method-add-observations-"></a></h3>
<p>Define and add a relationship between an observed variable and system states.
The observation equation takes the form</p>
<p><code>&lt;observation&gt; ~ h(t,&lt;states&gt;,&lt;inputs&gt;) + e)</code></p>
<p>where <code>h</code> is the observation function, and <code>e</code> is normally
distributed noise with zero mean and variance to be specified. The
observation variable should be present in the data provided when calling
<code>estimate(.data)</code> for parameter estimation.</p><div class="section">
<h4 id="usage-2">Usage<a class="anchor" aria-label="anchor" href="#usage-2"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_observations</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span>, obsnames <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-1">Arguments<a class="anchor" aria-label="anchor" href="#arguments-1"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula class specifying the obsevation equation to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas identical to <code>form</code> to specify multiple observation equations at a time.</p></dd>


<dt><code>obsnames</code></dt>
<dd><p>character vector specifying the name of the observation. When the observation left-hand side
consists of more than just a single variable name (when its class is 'call' instead of 'name') it will be
given a name on the form obs__# where # is a number, unless obsnames is provided.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a></h4>
<p></p><div class="r example copy"><div class="sourceCode"><pre><code>#Specify observation directly as a latent state
add_observations(y ~ x)

Specify observation as the sum of exponentials of two latent states
add_observations(y ~ exp(x1) + exp(x2))
</code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-add_observation_variances"></a><div class="section">
<h3 id="method-add-observation-variances-">Method <code><a href="add_observation_variances.html">add_observation_variances()</a></code><a class="anchor" aria-label="anchor" href="#method-add-observation-variances-"></a></h3>
<p>Specify the variance of an observation equation.</p>
<p>A defined observation variable <code>y</code> in e.g. <code>add_observations(y ~ 
h(t,&lt;states&gt;,&lt;inputs&gt;)</code> is pertubed by Gaussian noise with zero mean and
variance
to-be specified using <code>add_observation_variances(y ~ p(t,&lt;states&gt;,&lt;inputs&gt;)</code>.
We can for instance declare <code>add_observation_variances(y ~ sigma_x^2</code>
where <code>sigma_x</code> is a fixed effect parameter to be declared through
<code>add_parameters</code>.</p><div class="section">
<h4 id="usage-3">Usage<a class="anchor" aria-label="anchor" href="#usage-3"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_observation_variances</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-2">Arguments<a class="anchor" aria-label="anchor" href="#arguments-2"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula class specifying the obsevation equation to be added
to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas identical to <code>form</code> to specify multiple
observation equations at a time.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-add_inputs"></a><div class="section">
<h3 id="method-add-inputs-">Method <code><a href="add_inputs.html">add_inputs()</a></code><a class="anchor" aria-label="anchor" href="#method-add-inputs-"></a></h3>
<p>Declare variables as data inputs</p>
<p>Declare whether a variable contained in system, observation or observation
variance equations is an input variable. If e.g. the system equation contains
an input variable <code>u</code> then it is declared using <code>add_inputs(u)</code>.
The input <code>u</code> must be contained in the data.frame <code>.data</code> provided
when calling the <code>estimate</code> or <code>predict</code> methods.</p><div class="section">
<h4 id="usage-4">Usage<a class="anchor" aria-label="anchor" href="#usage-4"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_inputs</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-3">Arguments<a class="anchor" aria-label="anchor" href="#arguments-3"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>variable names that specifies the name of input variables in the defined system.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-add_parameters"></a><div class="section">
<h3 id="method-add-parameters-">Method <code><a href="add_parameters.html">add_parameters()</a></code><a class="anchor" aria-label="anchor" href="#method-add-parameters-"></a></h3>
<p>Declare which variables that are (fixed effects) parameters in
the specified model, and specify the initial optimizer value, as well as
lower / upper bounds during optimization. There are two ways to declare parameters:</p><ol><li><p>You can declare parameters using formulas i.e. <code>add_parameters( 
theta = c(1,0,10), mu = c(0,-10,10) )</code>. The first value is the initial
value for the optimizer, the second value is the lower optimization
bound and the third value is the upper optimization bound.</p></li>
<li><p>You can provide a 3-column matrix where rows corresponds to different
parameters, and the parameter names are provided as rownames of the matrix.
The columns values corresponds to the description in the vector format above.</p></li>
</ol><div class="section">
<h4 id="usage-5">Usage<a class="anchor" aria-label="anchor" href="#usage-5"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_parameters</span><span class="op">(</span><span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-4">Arguments<a class="anchor" aria-label="anchor" href="#arguments-4"></a></h4>
<p></p><div class="arguments"><dl><dt><code>...</code></dt>
<dd><p>a named vector or matrix as described above.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-add_algebraics"></a><div class="section">
<h3 id="method-add-algebraics-">Method <code><a href="add_algebraics.html">add_algebraics()</a></code><a class="anchor" aria-label="anchor" href="#method-add-algebraics-"></a></h3>
<p>Add algebraic relations.</p>
<p>Algebraic relations is a convenient way to transform parameters in your equations.
In the Ornstein-Uhlenbeck process the rate parameter <code>theta</code> is always positive, so
estimation in the log-domain is a good idea. Instead of writing <code>exp(theta)</code> directly
in the system equation one can transform into the log domain using the algebraic relation
<code>add_algebraics(theta ~ exp(logtheta))</code>. All instances of <code>theta</code> is replaced
by <code>exp(logtheta)</code> when compiling the C++ function. Note that you must provide values
for <code>logtheta</code> now instead of <code>theta</code> when declaring parameters through
<code>add_parameters</code></p><div class="section">
<h4 id="usage-6">Usage<a class="anchor" aria-label="anchor" href="#usage-6"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">add_algebraics</span><span class="op">(</span><span class="va">form</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-5">Arguments<a class="anchor" aria-label="anchor" href="#arguments-5"></a></h4>
<p></p><div class="arguments"><dl><dt><code>form</code></dt>
<dd><p>formula specifying the stochastic differential equation(s) to be added to the system.</p></dd>


<dt><code>...</code></dt>
<dd><p>additional formulas similar to <code>form</code> for specifying multiple equations at once.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-set_initial_state"></a><div class="section">
<h3 id="method-set-initial-state-">Method <code><a href="set_initial_state.html">set_initial_state()</a></code><a class="anchor" aria-label="anchor" href="#method-set-initial-state-"></a></h3>
<p>Declare the initial state values i.e. mean and covariance for the system states.</p><div class="section">
<h4 id="usage-7">Usage<a class="anchor" aria-label="anchor" href="#usage-7"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">set_initial_state</span><span class="op">(</span><span class="va">initial.state</span>, estimate <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-6">Arguments<a class="anchor" aria-label="anchor" href="#arguments-6"></a></h4>
<p></p><div class="arguments"><dl><dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>estimate</code></dt>
<dd><p>boolean value which indicates whether or not the initial conditions
shall be estimated as fixed effects parameters. The provided mean and covariance are then
used as initial guesses</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-set_lamperti"></a><div class="section">
<h3 id="method-set-lamperti-">Method <code>set_lamperti()</code><a class="anchor" aria-label="anchor" href="#method-set-lamperti-"></a></h3>
<p>Set a Lamperti Transformation</p>
<p>If the provided system equations have state dependent diffusion in a few available ways
then it is advantageous to perform a transformation to remove the state dependence. This
comes at the cost of a more complicated drift function. The following types of state-dependence
is currently supported</p><ol><li><p>'identity' - when the diffusion is state-independent (default)</p></li>
<li><p>'log' - when the diffusion is proportional to to x * dw</p></li>
<li><p>'logit' - when the diffusion is proportional to x * (1-x) * dw</p></li>
<li><p>'sqrt-logit' - when the diffusion is proportional to sqrt(x * (1-x)) * dw</p></li>
</ol><div class="section">
<h4 id="usage-8">Usage<a class="anchor" aria-label="anchor" href="#usage-8"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">set_lamperti</span><span class="op">(</span><span class="va">transforms</span>, states <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-7">Arguments<a class="anchor" aria-label="anchor" href="#arguments-7"></a></h4>
<p></p><div class="arguments"><dl><dt><code>transforms</code></dt>
<dd><p>character vector - one of either "identity, "log", "logit", "sqrt-logit"</p></dd>


<dt><code>states</code></dt>
<dd><p>a vector of the state names for which the specified transformations should be applied to.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-set_modelname"></a><div class="section">
<h3 id="method-set-modelname-">Method <code>set_modelname()</code><a class="anchor" aria-label="anchor" href="#method-set-modelname-"></a></h3>
<p>Set modelname used to create the C++ file for TMB</p>
<p>When calling <code><a href="https://rdrr.io/pkg/TMB/man/MakeADFun.html" class="external-link">TMB::MakeADFun</a></code> the (negative log) likelihood function
is created in the directory specified by the <code>set_cppfile_directory</code>
method with name <code>&lt;modelname&gt;.cpp</code></p><div class="section">
<h4 id="usage-9">Usage<a class="anchor" aria-label="anchor" href="#usage-9"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">set_modelname</span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-8">Arguments<a class="anchor" aria-label="anchor" href="#arguments-8"></a></h4>
<p></p><div class="arguments"><dl><dt><code>name</code></dt>
<dd><p>string defining the model name.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-set_cppfile_directory"></a><div class="section">
<h3 id="method-set-cppfile-directory-">Method <code>set_cppfile_directory()</code><a class="anchor" aria-label="anchor" href="#method-set-cppfile-directory-"></a></h3>
<p>Set the path directory where the constructed C++ file is created.
You should specify the entire path, unless you want to construct a subfolder
in the current working directory - then you can call e.g.
<code>set_cppfile_directory("folder_in_current_wd")</code>.</p><div class="section">
<h4 id="usage-10">Usage<a class="anchor" aria-label="anchor" href="#usage-10"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">set_cppfile_directory</span><span class="op">(</span><span class="va">directory</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-9">Arguments<a class="anchor" aria-label="anchor" href="#arguments-9"></a></h4>
<p></p><div class="arguments"><dl><dt><code>directory</code></dt>
<dd><p>string specifying a local directory</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-set_map"></a><div class="section">
<h3 id="method-set-map-">Method <code>set_map()</code><a class="anchor" aria-label="anchor" href="#method-set-map-"></a></h3>
<p>Enable maximum a posterior (MAP) estimation.</p>
<p>Adds a maximum a posterior contribution to the (negative log) likelihood
function by evaluating the fixed effects parameters in a multivariate Gaussian
with <code>mean</code> and <code>covariance</code> as provided.</p><div class="section">
<h4 id="usage-11">Usage<a class="anchor" aria-label="anchor" href="#usage-11"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">set_map</span><span class="op">(</span><span class="va">mean</span>, <span class="va">cov</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-10">Arguments<a class="anchor" aria-label="anchor" href="#arguments-10"></a></h4>
<p></p><div class="arguments"><dl><dt><code>mean</code></dt>
<dd><p>mean vector of the Gaussian prior parameter distribution</p></dd>


<dt><code>cov</code></dt>
<dd><p>covariance matrix of the Gaussian prior parameter distribution</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-get_systems"></a><div class="section">
<h3 id="method-get-systems-">Method <code>get_systems()</code><a class="anchor" aria-label="anchor" href="#method-get-systems-"></a></h3>
<p>Retrieve system equations.</p><div class="section">
<h4 id="usage-12">Usage<a class="anchor" aria-label="anchor" href="#usage-12"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_systems</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-get_observations"></a><div class="section">
<h3 id="method-get-observations-">Method <code>get_observations()</code><a class="anchor" aria-label="anchor" href="#method-get-observations-"></a></h3>
<p>Retrieve observation equations.</p><div class="section">
<h4 id="usage-13">Usage<a class="anchor" aria-label="anchor" href="#usage-13"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_observations</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-get_observation_variances"></a><div class="section">
<h3 id="method-get-observation-variances-">Method <code>get_observation_variances()</code><a class="anchor" aria-label="anchor" href="#method-get-observation-variances-"></a></h3>
<p>Retrieve observation variances</p><div class="section">
<h4 id="usage-14">Usage<a class="anchor" aria-label="anchor" href="#usage-14"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_observation_variances</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-get_algebraics"></a><div class="section">
<h3 id="method-get-algebraics-">Method <code>get_algebraics()</code><a class="anchor" aria-label="anchor" href="#method-get-algebraics-"></a></h3>
<p>Retrieve algebraic relations</p><div class="section">
<h4 id="usage-15">Usage<a class="anchor" aria-label="anchor" href="#usage-15"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_algebraics</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-get_initial_state"></a><div class="section">
<h3 id="method-get-initial-state-">Method <code>get_initial_state()</code><a class="anchor" aria-label="anchor" href="#method-get-initial-state-"></a></h3>
<p>Retrieve initially set state and covariance</p><div class="section">
<h4 id="usage-16">Usage<a class="anchor" aria-label="anchor" href="#usage-16"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_initial_state</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-get_parameters"></a><div class="section">
<h3 id="method-get-parameters-">Method <code>get_parameters()</code><a class="anchor" aria-label="anchor" href="#method-get-parameters-"></a></h3>
<p>Get initial (and estimated) parameters.</p><div class="section">
<h4 id="usage-17">Usage<a class="anchor" aria-label="anchor" href="#usage-17"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">get_parameters</span><span class="op">(</span>type <span class="op">=</span> <span class="st">"all"</span>, value <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-11">Arguments<a class="anchor" aria-label="anchor" href="#arguments-11"></a></h4>
<p></p><div class="arguments"><dl><dt><code>type</code></dt>
<dd><p>one of "all", free" or "fixed" parameters.</p></dd>


<dt><code>value</code></dt>
<dd><p>one of "all", initial", "estimate", "lower" or "upper"</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-construct_nll"></a><div class="section">
<h3 id="method-construct-nll-">Method <code>construct_nll()</code><a class="anchor" aria-label="anchor" href="#method-construct-nll-"></a></h3>
<p>Construct and extract function handlers for the negative
log likelihood function.</p>
<p>The handlers from <code>TMB</code>'s <code>MakeADFun</code> are constructed and returned.
This enables the user to e.g. choose their own optimization algorithm, or just
have more control of the optimization workflow.</p><div class="section">
<h4 id="usage-18">Usage<a class="anchor" aria-label="anchor" href="#usage-18"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">construct_nll</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  unscented_hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0</span>, kappa <span class="op">=</span> <span class="fl">3</span> <span class="op">-</span> <span class="va">private</span><span class="op">$</span><span class="va">number.of.states</span><span class="op">)</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-12">Arguments<a class="anchor" aria-label="anchor" href="#arguments-12"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>a data.frame containing time-vector 't', observations and inputs.
The observations can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector - one of either "ekf", "ukf" or "tmb". Sets the estimation
method. The package has three available methods implemented:</p><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>the time-step used in the filtering schemes. The
time-step has two different uses depending on the chosen method.</p><ol><li><p>Kalman Filters: The time-step is used when numerically solving the
moment differential equations.</p></li>
<li><p>Laplace Approximation: The time-step is used in the Euler-Maruyama
simulation scheme for simulating a sample path of the stochastic differential
equation, which serves to link together the latent (random effects) states.</p></li>
</ol><p>The defined step-size is used to calculate the number of steps between
observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residauls as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approxmation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>unscented_hyperpars</code></dt>
<dd><p>the three hyper-parameters <code>alpha</code>, <code>beta</code> and <code>kappa</code> defining
the unscented transformation.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not compile the C++ objective
function but assume it is already compiled and corresponds to the specified model object. It is
the user's responsibility to ensure correspondence between the specified model and the precompiled
C++ object. If a precompiled C++ object is not found in the specified directory i.e.
in <code>&lt;cppfile_directory&gt;/&lt;modelname&gt;/(dll/so)</code> then the compile flag is set to <code>TRUE</code>.
If the user makes changes to system equations, observation equations, observation variances,
algebraic relations or lamperi transformations then the C++ object should be recompiled.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-estimate"></a><div class="section">
<h3 id="method-estimate-">Method <code>estimate()</code><a class="anchor" aria-label="anchor" href="#method-estimate-"></a></h3>
<p>Estimate the fixed effects parameters in the specified model.</p><div class="section">
<h4 id="usage-19">Usage<a class="anchor" aria-label="anchor" href="#usage-19"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">estimate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  loss <span class="op">=</span> <span class="st">"quadratic"</span>,</span>
<span>  loss_c <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  unscented_hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0</span>, kappa <span class="op">=</span> <span class="fl">3</span> <span class="op">-</span> <span class="va">private</span><span class="op">$</span><span class="va">number.of.states</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>trace <span class="op">=</span> <span class="fl">1</span>, iter.max <span class="op">=</span> <span class="fl">1e+05</span>, eval.max <span class="op">=</span> <span class="fl">1e+05</span><span class="op">)</span>,</span>
<span>  use.hessian <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  laplace.residuals <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  unconstrained.optim <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  compile <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-13">Arguments<a class="anchor" aria-label="anchor" href="#arguments-13"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><p>character vector - one of either "ekf", "ukf" or "tmb". Sets the estimation
method. The package has three available methods implemented:</p><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>loss</code></dt>
<dd><p>character vector. Sets the loss function type (only implemented for the kalman filter
methods). The loss function is per default quadratic in the one-step residauls as is natural
when the Gaussian (negative log) likelihood is evaluated, but if the tails of the
distribution is considered too small i.e. outliers are weighted too much, then one
can choose loss functions that accounts for this. The three available types available:</p><ol><li><p>Quadratic loss (<code>quadratic</code>).</p></li>
<li><p>Quadratic-Linear (<code>huber</code>)</p></li>
<li><p>Quadratic-Constant (<code>tukey</code>)</p></li>
</ol><p>The cutoff for the Huber and Tukey loss functions are determined from a provided cutoff
parameter <code>loss_c</code>. The implementations of these losses are approximations (pseudo-huber and sigmoid
approxmation respectively) for smooth derivatives.</p></dd>


<dt><code>loss_c</code></dt>
<dd><p>cutoff value for huber and tukey loss functions. Defaults to <code>c=3</code></p></dd>


<dt><code>unscented_hyperpars</code></dt>
<dd><p>the three hyper-parameters <code>alpha</code>, <code>beta</code> and <code>kappa</code> defining
the unscented transformation.</p></dd>


<dt><code>control</code></dt>
<dd><p>list of control parameters parsed to <code>nlminb</code> as its <code>control</code> argument.
See <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">?stats::nlminb</a></code> for more information</p></dd>


<dt><code>use.hessian</code></dt>
<dd><p>boolean value. The default (<code>TRUE</code>) causes the optimization algorithm
<code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">stats::nlminb</a></code> to use the fixed effects hessian of the (negative log) likelihood when
performing the optimization. This feature is only available for the kalman filter methods
without any random effects.</p></dd>


<dt><code>laplace.residuals</code></dt>
<dd><p>boolean - whether or not to calculate one-step ahead residuls
using the method of <a href="https://rdrr.io/pkg/TMB/man/oneStepPredict.html" class="external-link">oneStepPredict</a>.</p></dd>


<dt><code>unconstrained.optim</code></dt>
<dd><p>boolean value. When TRUE then the optimization is carried out unconstrained i.e.
without any of the parameter bounds specified during <code>add_parameters</code>.</p></dd>


<dt><code>compile</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not compile the C++ objective
function but assume it is already compiled and corresponds to the specified model object. It is
the user's responsibility to ensure correspondence between the specified model and the precompiled
C++ object. If a precompiled C++ object is not found in the specified directory i.e.
in <code>&lt;cppfile_directory&gt;/&lt;modelname&gt;/(dll/so)</code> then the compile flag is set to <code>TRUE</code>.
If the user makes changes to system equations, observation equations, observation variances,
algebraic relations or lamperi transformations then the C++ object should be recompiled.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-simulate"></a><div class="section">
<h3 id="method-simulate-">Method <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code><a class="anchor" aria-label="anchor" href="#method-simulate-"></a></h3>
<p>Perform prediction/filtration to obtain state mean and covariance estimates. The predictions are
obtained by solving the moment equations <code>n.ahead</code> steps forward in time when using the current step posterior
state estimate as the initial condition.</p><div class="section">
<h4 id="usage-20">Usage<a class="anchor" aria-label="anchor" href="#usage-20"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">get_initial_state</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  n.sims <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  simulation.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  k.ahead <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  return.k.ahead <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  unscented_hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0</span>, kappa <span class="op">=</span> <span class="fl">3</span> <span class="op">-</span> <span class="va">private</span><span class="op">$</span><span class="va">number.of.states</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-14">Arguments<a class="anchor" aria-label="anchor" href="#arguments-14"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>add_parameters</code>, unless the <code>estimate</code>
function has been run, then the default values will be those at the found optimum.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>n.sims</code></dt>
<dd><p>number of simulations</p></dd>


<dt><code>simulation.timestep</code></dt>
<dd><p>timestep used in the euler-maruyama scheme</p></dd>


<dt><code>k.ahead</code></dt>
<dd><p>integer specifying the desired number of time-steps (as determined by the provided
data time-vector) for which predictions are made (integrating the moment ODEs forward in time without
data updates).</p></dd>


<dt><code>return.k.ahead</code></dt>
<dd><p>numeric vector of integers specifying which n.ahead predictions to that
should be returned.</p></dd>


<dt><code>unscented_hyperpars</code></dt>
<dd><p>the three hyper-parameters <code>alpha</code>, <code>beta</code> and <code>kappa</code> defining
the unscented transformation.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


<dt><code>return.covariance</code></dt>
<dd><p>booelan value to indicate whether the covariance (instead of the correlation)
should be returned.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns">Returns<a class="anchor" aria-label="anchor" href="#returns"></a></h4>
<p>A data.frame that contains for each time step the posterior state estimate at that time.step (<code>k = 0</code>), and the
prior state predictions (<code>k = 1,...,n.ahead</code>). If <code>return.covariance = TRUE</code> then the state covariance/correlation
matrix is returned, otherwise only the marginal variances are returned.</p>
</div>

</div><p></p><hr><a id="method-sdeTMB-predict"></a><div class="section">
<h3 id="method-predict-">Method <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code><a class="anchor" aria-label="anchor" href="#method-predict-"></a></h3>
<p>Perform prediction/filtration to obtain state mean and covariance estimates. The predictions are
obtained by solving the moment equations <code>n.ahead</code> steps forward in time when using the current step posterior
state estimate as the initial condition.</p><div class="section">
<h4 id="usage-21">Usage<a class="anchor" aria-label="anchor" href="#usage-21"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"ekf"</span>,</span>
<span>  ode.timestep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">t</span><span class="op">)</span>,</span>
<span>  ode.solver <span class="op">=</span> <span class="st">"rk4"</span>,</span>
<span>  pars <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  initial.state <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">get_initial_state</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  k.ahead <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  return.k.ahead <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="va">k.ahead</span>,</span>
<span>  return.covariance <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  unscented_hyperpars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">1</span>, beta <span class="op">=</span> <span class="fl">0</span>, kappa <span class="op">=</span> <span class="fl">3</span> <span class="op">-</span> <span class="va">private</span><span class="op">$</span><span class="va">number.of.states</span><span class="op">)</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-15">Arguments<a class="anchor" aria-label="anchor" href="#arguments-15"></a></h4>
<p></p><div class="arguments"><dl><dt><code>data</code></dt>
<dd><p>data.frame containing time-vector 't', observations and inputs. The observations
can take <code>NA</code>-values.</p></dd>


<dt><code>method</code></dt>
<dd><ol><li><p>The natural TMB-style formulation where latent states are considered random effects
and are integrated out using the Laplace approximation. This method only yields the gradient
of the (negative log) likelihood function with respect to the fixed effects for optimization.
The method is slower although probably has some precision advantages, and allows for non-Gaussian
observation noise (not yet implemented). One-step / K-step residuals are not yet available in
the package.</p></li>
<li><p>(Continous-Discrete) Extended Kalman Filter where the system dynamics are linearized
to handle potential non-linearities. This is computationally the fastest method.</p></li>
<li><p>(Continous-Discrete) Unscented Kalman Filter. This is a higher order non-linear Kalman Filter
which improves the mean and covariance estimates when the system display high nonlinearity, and
circumvents the necessity to compute the jacobian of the drift and observation functions.</p></li>
</ol><p>All package features are currently available for the kalman filters, while TMB is limited to
parameter estimation. In particular, it is straight-forward to obtain k-step-ahead predictions
with these methods (use the <code>predict</code> S3 method), and stochastic simulation is also available
in the cases where long prediction horizons are sought, where the normality assumption will be
inaccurate.</p></dd>


<dt><code>ode.timestep</code></dt>
<dd><p>numeric value. Sets the time step-size in numerical filtering schemes.
The defined step-size is used to calculate the number of steps between observation time-points as
defined by the provided <code>data</code>. If the calculated number of steps is larger than N.01 where N
is an integer, then the time-step is reduced such that exactly N+1 steps is taken between observations
The step-size is used in the two following ways depending on the
chosen method:</p><ol><li><p>Kalman filters: The time-step is used as the step-size in the
numerical Forward-Euler scheme to compute the prior state mean and
covariance estimate as the final time solution to the first and second
order moment differential equations.</p></li>
<li><p>TMB method: The time-step is used as the step-size in the Euler-Maruyama
scheme for simulating a sample path of the stochastic differential equation,
which serves to link together the latent (random effects) states.</p></li>
</ol></dd>


<dt><code>ode.solver</code></dt>
<dd><p>Sets the ODE solver used in the Kalman Filter methods for solving the moment
differential equations. The default "euler" is the Forward Euler method, alternatively the classical
4th order Runge Kutta method is available via "rk4".</p></dd>


<dt><code>pars</code></dt>
<dd><p>fixed parameter vector parsed to the objective function for prediction/filtration. The default
parameter values used are the initial parameters provided through <code>add_parameters</code>, unless the <code>estimate</code>
function has been run, then the default values will be those at the found optimum.</p></dd>


<dt><code>initial.state</code></dt>
<dd><p>a named list of two entries 'x0' and 'p0' containing the initial state and covariance of the state</p></dd>


<dt><code>k.ahead</code></dt>
<dd><p>integer specifying the desired number of time-steps (as determined by the provided
data time-vector) for which predictions are made (integrating the moment ODEs forward in time without
data updates).</p></dd>


<dt><code>return.k.ahead</code></dt>
<dd><p>numeric vector of integers specifying which n.ahead predictions to that
should be returned.</p></dd>


<dt><code>return.covariance</code></dt>
<dd><p>booelan value to indicate whether the covariance (instead of the correlation)
should be returned.</p></dd>


<dt><code>unscented_hyperpars</code></dt>
<dd><p>the three hyper-parameters <code>alpha</code>, <code>beta</code> and <code>kappa</code> defining
the unscented transformation.</p></dd>


<dt><code>silent</code></dt>
<dd><p>logical value whether or not to suppress printed messages such as 'Checking Data',
'Building Model', etc. Default behaviour (FALSE) is to print the messages.</p></dd>


</dl><p></p></div>
</div>
<div class="section">
<h4 id="returns-1">Returns<a class="anchor" aria-label="anchor" href="#returns-1"></a></h4>
<p>A data.frame that contains for each time step the posterior state estimate at that time.step (<code>k = 0</code>), and the
prior state predictions (<code>k = 1,...,n.ahead</code>). If <code>return.covariance = TRUE</code> then the state covariance/correlation
matrix is returned, otherwise only the marginal variances are returned.</p>
</div>

</div><p></p><hr><a id="method-sdeTMB-print"></a><div class="section">
<h3 id="method-print-">Method <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code><a class="anchor" aria-label="anchor" href="#method-print-"></a></h3>
<p>Function to print the model object</p><div class="section">
<h4 id="usage-22">Usage<a class="anchor" aria-label="anchor" href="#usage-22"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>


</div><p></p><hr><a id="method-sdeTMB-summary"></a><div class="section">
<h3 id="method-summary-">Method <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code><a class="anchor" aria-label="anchor" href="#method-summary-"></a></h3>
<p>Summary function for fit</p><div class="section">
<h4 id="usage-23">Usage<a class="anchor" aria-label="anchor" href="#usage-23"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">summary</span><span class="op">(</span>correlation <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-16">Arguments<a class="anchor" aria-label="anchor" href="#arguments-16"></a></h4>
<p></p><div class="arguments"><dl><dt><code>correlation</code></dt>
<dd><p>boolean value. The default (<code>FALSE</code>) is to not provide the fixed effects parameter
correlation matrix.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-plot"></a><div class="section">
<h3 id="method-plot-">Method <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code><a class="anchor" aria-label="anchor" href="#method-plot-"></a></h3>
<p>Function to print the model object</p><div class="section">
<h4 id="usage-24">Usage<a class="anchor" aria-label="anchor" href="#usage-24"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span></span>
<span>  plot.obs <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  pacf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  extended <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  ggtheme <span class="op">=</span> <span class="fu">getggplot2theme</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-17">Arguments<a class="anchor" aria-label="anchor" href="#arguments-17"></a></h4>
<p></p><div class="arguments"><dl><dt><code>plot.obs</code></dt>
<dd><p>a vector to indicate which observations should be plotted for. If multiple
are chosen a list of plots for each observation is returned.</p></dd>


<dt><code>pacf</code></dt>
<dd><p>logical to indicate whether or not the partial autocorrelations should be returned.
The default is FALSE in which case a histogram is returned instead.</p></dd>


<dt><code>extended</code></dt>
<dd><p>logical. if TRUE additional information is printed</p></dd>


<dt><code>ggtheme</code></dt>
<dd><p>ggplot2 theme to use for creating the ggplot.</p></dd>


</dl><p></p></div>
</div>

</div><p></p><hr><a id="method-sdeTMB-clone"></a><div class="section">
<h3 id="method-clone-">Method <code>clone()</code><a class="anchor" aria-label="anchor" href="#method-clone-"></a></h3>
<p>The objects of this class are cloneable with this method.</p><div class="section">
<h4 id="usage-25">Usage<a class="anchor" aria-label="anchor" href="#usage-25"></a></h4>
<p></p><div class="r"><div class="sourceCode"><pre><code><span><span class="va">sdeTMB</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span>deep <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div><p></p></div>
</div>

<div class="section">
<h4 id="arguments-18">Arguments<a class="anchor" aria-label="anchor" href="#arguments-18"></a></h4>
<p></p><div class="arguments"><dl><dt><code>deep</code></dt>
<dd><p>Whether to make a deep clone.</p></dd>


</dl><p></p></div>
</div>

</div>

    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Phillip Vetter.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

